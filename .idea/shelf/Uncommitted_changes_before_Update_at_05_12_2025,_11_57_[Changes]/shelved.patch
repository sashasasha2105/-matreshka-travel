Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"AutoImportSettings\">\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\n  </component>\n  <component name=\"ChangeListManager\">\n    <list default=\"true\" id=\"dd47a965-f12a-4a93-aeef-bdfe1913fef0\" name=\"Changes\" comment=\"\">\n      <change beforePath=\"$PROJECT_DIR$/.claude/settings.local.json\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.claude/settings.local.json\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/assets/data/packages.js\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/assets/data/packages.js\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/assets/data/regions.js\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/assets/data/regions.js\" afterDir=\"false\" />\n    </list>\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\n  </component>\n  <component name=\"FileTemplateManagerImpl\">\n    <option name=\"RECENT_TEMPLATES\">\n      <list>\n        <option value=\"Python Script\" />\n      </list>\n    </option>\n  </component>\n  <component name=\"Git.Settings\">\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\n  </component>\n  <component name=\"GitHubPullRequestSearchHistory\">{\n  &quot;lastFilter&quot;: {\n    &quot;state&quot;: &quot;OPEN&quot;,\n    &quot;assignee&quot;: &quot;sashasasha2105&quot;\n  }\n}</component>\n  <component name=\"GithubPullRequestsUISettings\">{\n  &quot;selectedUrlAndAccountId&quot;: {\n    &quot;url&quot;: &quot;git@github.com:sashasasha2105/-matreshka-travel.git&quot;,\n    &quot;accountId&quot;: &quot;067a9130-4a38-46bb-b12f-cc4275ca5e8e&quot;\n  }\n}</component>\n  <component name=\"ProjectColorInfo\">{\n  &quot;associatedIndex&quot;: 1\n}</component>\n  <component name=\"ProjectId\" id=\"3316FTaBKbemeG0tuyySVpqrdmM\" />\n  <component name=\"ProjectViewState\">\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\n    <option name=\"showLibraryContents\" value=\"true\" />\n  </component>\n  <component name=\"PropertiesComponent\">{\n  &quot;keyToString&quot;: {\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\n    &quot;git-widget-placeholder&quot;: &quot;main&quot;,\n    &quot;last_opened_file_path&quot;: &quot;/Users/alexbrizkiy/PycharmProjects/PythonProject20/city_photos&quot;\n  }\n}</component>\n  <component name=\"RecentsManager\">\n    <key name=\"CopyFile.RECENT_KEYS\">\n      <recent name=\"$PROJECT_DIR$/city_photos\" />\n      <recent name=\"$PROJECT_DIR$\" />\n    </key>\n    <key name=\"MoveFile.RECENT_KEYS\">\n      <recent name=\"$PROJECT_DIR$/TeamPhotos\" />\n      <recent name=\"$PROJECT_DIR$/city_photos\" />\n      <recent name=\"$PROJECT_DIR$/profile\" />\n    </key>\n  </component>\n  <component name=\"SharedIndexes\">\n    <attachedChunks>\n      <set>\n        <option value=\"bundled-python-sdk-495700d161d3-aa17d162503b-com.jetbrains.pycharm.community.sharedIndexes.bundled-PC-243.22562.220\" />\n      </set>\n    </attachedChunks>\n  </component>\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\n  <component name=\"TaskManager\">\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\n      <changelist id=\"dd47a965-f12a-4a93-aeef-bdfe1913fef0\" name=\"Changes\" comment=\"\" />\n      <created>1758472127160</created>\n      <option name=\"number\" value=\"Default\" />\n      <option name=\"presentableId\" value=\"Default\" />\n      <updated>1758472127160</updated>\n    </task>\n    <servers />\n  </component>\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 8f6d951bebaad31c3e38bcab0f58b81da2f711d9)
+++ b/.idea/workspace.xml	(date 1764920423342)
@@ -9,6 +9,11 @@
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/assets/data/packages.js" beforeDir="false" afterPath="$PROJECT_DIR$/assets/data/packages.js" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/assets/data/regions.js" beforeDir="false" afterPath="$PROJECT_DIR$/assets/data/regions.js" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/backend/api/feed_api.py" beforeDir="false" afterPath="$PROJECT_DIR$/backend/api/feed_api.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/index.html" beforeDir="false" afterPath="$PROJECT_DIR$/index.html" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/scripts/modules/packages.js" beforeDir="false" afterPath="$PROJECT_DIR$/scripts/modules/packages.js" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/scripts/script.js" beforeDir="false" afterPath="$PROJECT_DIR$/scripts/script.js" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/styles/matreshka-optimized.css" beforeDir="false" afterPath="$PROJECT_DIR$/styles/matreshka-optimized.css" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
Index: scripts/script.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Инициализация Telegram Web App\nconst tg = window.Telegram?.WebApp;\nlet isTelegramWebApp = false;\n\n// \uD83D\uDD25 АВТООЧИСТКА ОТКЛЮЧЕНА - пользователь может очистить вручную через кнопку в корзине\nconsole.log('\uD83D\uDCBE Автоочистка localStorage отключена - данные сохраняются между сессиями');\n\nif (tg) {\n    isTelegramWebApp = true;\n\n    // Разворачиваем приложение на весь экран\n    tg.expand();\n\n    // Отключаем подтверждение при закрытии\n    tg.enableClosingConfirmation();\n\n    // Устанавливаем цвета темы\n    if (tg.setHeaderColor) {\n        tg.setHeaderColor('secondary_bg_color');\n    }\n    if (tg.setBackgroundColor) {\n        tg.setBackgroundColor('#0f0520');\n    }\n\n    // Готовность приложения\n    tg.ready();\n\n    console.log('✅ Telegram Web App инициализирован', {\n        version: tg.version,\n        platform: tg.platform,\n        colorScheme: tg.colorScheme,\n        viewportHeight: tg.viewportHeight,\n        isExpanded: tg.isExpanded\n    });\n\n    // Настраиваем BackButton для навигации\n    if (tg.BackButton) {\n        tg.BackButton.onClick(() => {\n            // Проверяем что сейчас показано\n            const regionDetails = document.getElementById('regionDetails');\n            const profileSection = document.getElementById('profileSection');\n\n            if (regionDetails && regionDetails.style.display !== 'none') {\n                goBack();\n                tg.BackButton.hide();\n            } else if (profileSection && profileSection.style.display !== 'none') {\n                hideProfile();\n                tg.BackButton.hide();\n            }\n        });\n    }\n} else {\n    console.log('ℹ\uFE0F Приложение запущено вне Telegram');\n}\n\n// Глобальная лента путешествий (пустая по умолчанию)\nlet globalTravelFeed = [];\n\n// \uD83D\uDD25 СИСТЕМА УПРАВЛЕНИЯ СОСТОЯНИЕМ ВКЛАДОК\nlet currentActiveSection = 'main'; // main, feed, profile, cart, quests\n\n// Сохранение текущей вкладки в sessionStorage\nfunction saveCurrentSection(sectionName) {\n    currentActiveSection = sectionName;\n    sessionStorage.setItem('activeSection', sectionName);\n    console.log('\uD83D\uDCBE Сохранена активная вкладка:', sectionName);\n}\n\n// Восстановление активной вкладки при загрузке\nfunction restoreActiveSection() {\n    const savedSection = sessionStorage.getItem('activeSection');\n    if (savedSection) {\n        console.log('\uD83D\uDD04 Восстанавливаем вкладку:', savedSection);\n        switch (savedSection) {\n            case 'main':\n                showMainSection();\n                break;\n            case 'feed':\n                showFeed();\n                break;\n            case 'profile':\n                showProfile();\n                break;\n            case 'cart':\n                showCart();\n                break;\n            case 'quests':\n                showQuests();\n                break;\n            default:\n                showMainSection();\n        }\n    }\n}\n\n// Глобальные переменные\n\n// Утилита debounce для оптимизации производительности\nfunction debounce(func, wait) {\n    let timeout;\n    return function executedFunction(...args) {\n        const later = () => {\n            clearTimeout(timeout);\n            func(...args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n    };\n}\n\n// Получаем данные регионов из внешнего файла\nlet russiaRegions = [];\n\n// Загружаем данные при старте\nfunction loadRegionsData() {\n    if (window.RUSSIA_REGIONS_DATA) {\n        russiaRegions = Object.values(window.RUSSIA_REGIONS_DATA);\n        console.log('✅ Загружено регионов:', russiaRegions.length);\n        console.log('\uD83D\uDCCB Первый регион:', russiaRegions[0]?.name);\n    } else {\n        console.warn('⚠\uFE0F Данные регионов не найдены');\n        console.log('\uD83D\uDD0D window.RUSSIA_REGIONS_DATA:', window.RUSSIA_REGIONS_DATA);\n    }\n}\n\n// Системы поиска и пагинации\nlet searchQuery = '';\nlet currentPage = 0;\nconst REGIONS_PER_PAGE = 6;\nlet filteredRegions = [];\n\n// Пакеты путешествий\nconst travelPackages = [\n    {\n        id: 'ural',\n        name: 'Урал',\n        description: 'Величественные горы и промышленные города',\n        emoji: '⛰\uFE0F',\n        price: 'от 35 000 ₽',\n        duration: '7 дней',\n        image: './city_photos/Челябинская область.jpg',\n        regions: ['Екатеринбург', 'Челябинск', 'Пермь'],\n        highlights: ['Граница Европы и Азии', 'Уральские горы', 'Музей Ельцина']\n    },\n    {\n        id: 'caucasus',\n        name: 'Кавказ',\n        description: 'Горные вершины и минеральные источники',\n        emoji: '\uD83C\uDFD4\uFE0F',\n        price: 'от 45 000 ₽',\n        duration: '8 дней',\n        image: './city_photos/Кабардино-Балкария.jpg',\n        regions: ['Сочи', 'Кисловодск', 'Домбай'],\n        highlights: ['Эльбрус', 'Красная Поляна', 'Нарзанные источники']\n    },\n    {\n        id: 'golden-ring',\n        name: 'Золотое кольцо',\n        description: 'Древние города и православные святыни',\n        emoji: '⛪',\n        price: 'от 25 000 ₽',\n        duration: '5 дней',\n        image: './city_photos/GOLDRING.jpg',\n        regions: ['Суздаль', 'Владимир', 'Сергиев Посад'],\n        highlights: ['Древние храмы', 'Музеи-заповедники', 'Народные промыслы']\n    }\n];\n\n// Функция отображения пользователя\nfunction displayUserInfo() {\n    const userNameEl = document.getElementById('userName');\n    if (!userNameEl) return;\n\n    if (tg && tg.initDataUnsafe?.user) {\n        const user = tg.initDataUnsafe.user;\n        // Капитализируем первую букву имени\n        const capitalizedName = user.first_name.charAt(0).toUpperCase() + user.first_name.slice(1);\n        userNameEl.innerHTML = `Привет, ${capitalizedName}!`;\n    } else {\n        userNameEl.innerHTML = 'Добро пожаловать!';\n    }\n}\n\n// Функция поиска регионов (внутренняя, без debounce)\nfunction searchRegionsInternal(query) {\n    searchQuery = query.toLowerCase().trim();\n    currentPage = 0; // Сбрасываем на первую страницу\n    loadRegions();\n\n    // Обновляем счетчик в реальном времени\n    const regionsGrid = document.getElementById('regionsGrid');\n    if (regionsGrid) {\n        const totalRegions = getFilteredRegions().length;\n        console.log(`\uD83D\uDD0D Поиск: \"${query}\" - найдено ${totalRegions} регионов`);\n    }\n}\n\n// Функция поиска регионов с debounce (публичная)\nconst searchRegions = debounce(searchRegionsInternal, 300);\n\n// Функция фильтрации регионов\nfunction getFilteredRegions() {\n    if (!searchQuery) {\n        return russiaRegions;\n    }\n\n    return russiaRegions.filter(region => {\n        return region.name.toLowerCase().includes(searchQuery) ||\n               region.description.toLowerCase().includes(searchQuery) ||\n               region.about.toLowerCase().includes(searchQuery);\n    });\n}\n\n// Функция загрузки регионов с пагинацией + УМНАЯ ПРЕДЗАГРУЗКА\nfunction loadRegions() {\n    console.log('\uD83D\uDD04 Вызвана loadRegions()');\n    const regionsGrid = document.getElementById('regionsGrid');\n    if (!regionsGrid) {\n        console.error('❌ Элемент regionsGrid не найден!');\n        return;\n    }\n\n    // Загружаем данные если еще не загружены\n    if (russiaRegions.length === 0) {\n        console.log('\uD83D\uDD04 Перезагружаем данные регионов...');\n        loadRegionsData();\n    }\n\n    console.log('\uD83D\uDCCA Доступно регионов:', russiaRegions.length);\n    filteredRegions = getFilteredRegions();\n    console.log('\uD83D\uDD0D Отфильтровано регионов:', filteredRegions.length);\n\n    if (currentPage === 0) {\n        // Первая загрузка - очищаем все и показываем первые 6\n        regionsGrid.innerHTML = '';\n\n        // Проверяем есть ли результаты поиска\n        if (filteredRegions.length === 0 && searchQuery) {\n            // Показываем сообщение о пустом результате поиска\n            regionsGrid.innerHTML = `\n                <div class=\"search-empty\">\n                    <div class=\"search-empty-icon\">\uD83D\uDD0D</div>\n                    <div class=\"search-empty-title\">Ничего не найдено</div>\n                    <div class=\"search-empty-text\">По запросу \"${searchQuery}\" регионы не найдены</div>\n                    <button class=\"search-clear-btn\" onclick=\"clearSearchAndReload()\">\n                        <span>✕</span>\n                        <span>Очистить поиск</span>\n                    </button>\n                </div>\n            `;\n            return;\n        }\n\n        const regionsToShow = filteredRegions.slice(0, REGIONS_PER_PAGE);\n\n        regionsToShow.forEach((region, index) => {\n            const regionCard = createRegionCard(region, index);\n            regionsGrid.appendChild(regionCard);\n        });\n\n        // \uD83D\uDE80 УМНАЯ ПРЕДЗАГРУЗКА следующих регионов\n        if (window.performanceOptimizer && filteredRegions.length > REGIONS_PER_PAGE) {\n            const nextRegions = filteredRegions.slice(REGIONS_PER_PAGE, REGIONS_PER_PAGE + 6);\n            const nextImages = nextRegions.map(r => r.image);\n            window.performanceOptimizer.prefetchImages(nextImages);\n            console.log('\uD83D\uDCE6 Запущена предзагрузка', nextImages.length, 'следующих изображений');\n        }\n    } else {\n        // Дополнительная загрузка - добавляем следующие 6\n        const startIndex = currentPage * REGIONS_PER_PAGE;\n        const endIndex = startIndex + REGIONS_PER_PAGE;\n        const regionsToShow = filteredRegions.slice(startIndex, endIndex);\n\n        regionsToShow.forEach((region, index) => {\n            const regionCard = createRegionCard(region, startIndex + index);\n            regionsGrid.appendChild(regionCard);\n        });\n\n        // \uD83D\uDE80 ПРЕДЗАГРУЗКА следующей порции\n        if (window.performanceOptimizer && endIndex < filteredRegions.length) {\n            const nextRegions = filteredRegions.slice(endIndex, endIndex + 6);\n            const nextImages = nextRegions.map(r => r.image);\n            window.performanceOptimizer.prefetchImages(nextImages);\n            console.log('\uD83D\uDCE6 Предзагрузка следующих', nextImages.length, 'изображений');\n        }\n    }\n\n    // Обновляем кнопку \"Показать больше\"\n    updateLoadMoreButton();\n\n    // Загружаем ленту путешествий после первой загрузки\n    if (currentPage === 0) {\n        loadTravelFeed();\n    }\n}\n\n// Функция очистки поиска и перезагрузки\nfunction clearSearchAndReload() {\n    const searchInput = document.getElementById('regionSearch');\n    if (searchInput) {\n        searchInput.value = '';\n    }\n    searchQuery = '';\n    currentPage = 0;\n    loadRegions();\n\n    // Скрываем кнопку очистки\n    const clearBtn = document.querySelector('.search-clear');\n    if (clearBtn) {\n        clearBtn.style.display = 'none';\n    }\n}\n\n// Создание карточки региона с ТУРБО-ОПТИМИЗАЦИЕЙ + ACETERNITY EFFECTS\nfunction createRegionCard(region, animationIndex) {\n    const regionCard = document.createElement('div');\n    regionCard.className = 'region-card aceternity-card spotlight-container ripple';\n    regionCard.onclick = () => showRegionDetails(region.id);\n\n    // Добавляем spotlight эффект\n    const spotlight = document.createElement('div');\n    spotlight.className = 'spotlight';\n    regionCard.appendChild(spotlight);\n\n    // 3D tilt эффект при движении мыши\n    regionCard.addEventListener('mousemove', (e) => {\n        const rect = regionCard.getBoundingClientRect();\n        const x = ((e.clientX - rect.left) / rect.width - 0.5) * 20;\n        const y = ((e.clientY - rect.top) / rect.height - 0.5) * -20;\n        regionCard.style.setProperty('--mouse-x', `${x}deg`);\n        regionCard.style.setProperty('--mouse-y', `${y}deg`);\n\n        // Перемещаем spotlight\n        spotlight.style.left = `${e.clientX - rect.left - 200}px`;\n        spotlight.style.top = `${e.clientY - rect.top - 200}px`;\n    });\n\n    regionCard.addEventListener('mouseleave', () => {\n        regionCard.style.setProperty('--mouse-x', '0deg');\n        regionCard.style.setProperty('--mouse-y', '0deg');\n    });\n\n    // Создаем img элемент отдельно для оптимизации\n    const img = document.createElement('img');\n    img.className = 'region-image';\n    img.alt = region.name;\n    img.loading = 'lazy';\n\n    // Используем Performance Optimizer для мгновенной загрузки\n    if (window.performanceOptimizer) {\n        // Определяем приоритет: первые 3 карточки - высокий\n        const priority = animationIndex < 3 ? 'high' : 'normal';\n\n        // Мгновенная загрузка через оптимизатор\n        window.performanceOptimizer.loadImageInstantly(region.image, img, priority);\n    } else {\n        // Fallback\n        img.src = region.image;\n    }\n\n    // Создаем контент\n    const content = document.createElement('div');\n    content.className = 'region-content';\n    content.innerHTML = `\n        <div class=\"region-name\">${region.name}</div>\n        <div class=\"region-description\">${region.description}</div>\n        <div class=\"region-stats\">\n            <span>\uD83D\uDC65 ${region.population}</span>\n            <span>\uD83D\uDCD0 ${region.area}</span>\n        </div>\n    `;\n\n    regionCard.appendChild(img);\n    regionCard.appendChild(content);\n\n    // Анимация появления\n    regionCard.style.animation = `fadeInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) ${(animationIndex % REGIONS_PER_PAGE) * 100}ms forwards`;\n    regionCard.style.opacity = '0';\n\n    return regionCard;\n}\n\n// Функция обновления кнопки \"Показать больше\"\nfunction updateLoadMoreButton() {\n    let loadMoreBtn = document.getElementById('loadMoreBtn');\n\n    if (!loadMoreBtn) {\n        // Создаем кнопку если её нет\n        loadMoreBtn = document.createElement('div');\n        loadMoreBtn.id = 'loadMoreBtn';\n        loadMoreBtn.className = 'load-more-container';\n\n        const regionsGrid = document.getElementById('regionsGrid');\n        regionsGrid.parentNode.insertBefore(loadMoreBtn, regionsGrid.nextSibling);\n    }\n\n    const displayedRegions = (currentPage + 1) * REGIONS_PER_PAGE;\n    const hasMoreRegions = displayedRegions < filteredRegions.length;\n\n    if (hasMoreRegions) {\n        const remainingRegions = filteredRegions.length - displayedRegions;\n        const nextBatchSize = Math.min(remainingRegions, REGIONS_PER_PAGE);\n\n        loadMoreBtn.innerHTML = `\n            <button class=\"load-more-btn\" onclick=\"loadMoreRegions()\">\n                <span class=\"load-more-icon\">⬇\uFE0F</span>\n                <span class=\"load-more-text\">Показать еще ${nextBatchSize} ${nextBatchSize === 1 ? 'регион' : nextBatchSize < 5 ? 'региона' : 'регионов'}</span>\n                <span class=\"load-more-count\">(осталось ${remainingRegions})</span>\n            </button>\n        `;\n        loadMoreBtn.style.display = 'block';\n    } else {\n        loadMoreBtn.style.display = 'none';\n    }\n}\n\n// Функция загрузки дополнительных регионов\nfunction loadMoreRegions() {\n    currentPage++;\n\n    // Показываем лоадер\n    const loadMoreBtn = document.getElementById('loadMoreBtn');\n    const originalContent = loadMoreBtn.innerHTML;\n\n    loadMoreBtn.innerHTML = `\n        <div class=\"load-more-loading\">\n            <div class=\"load-more-spinner\"></div>\n            <span>Загружаем регионы...</span>\n        </div>\n    `;\n\n    // Имитируем загрузку для плавности\n    setTimeout(() => {\n        loadRegions();\n    }, 800);\n}\n\n// Функция загрузки ленты путешествий в стиле VK\nfunction loadTravelFeed() {\n    const travelFeed = document.getElementById('travelFeed');\n    if (!travelFeed) return;\n\n    if (globalTravelFeed.length === 0) {\n        travelFeed.innerHTML = `\n            <div class=\"feed-empty\">\n                <span class=\"empty-icon\">\uD83D\uDCDD</span>\n                <p>Пока нет публикаций</p>\n                <small>Станьте первым, кто поделится своим путешествием!</small>\n            </div>\n        `;\n        return;\n    }\n\n    travelFeed.innerHTML = '';\n\n    globalTravelFeed.forEach((post, index) => {\n        const postElement = document.createElement('div');\n        postElement.className = 'travel-feed-card';\n\n        // Генерируем grid для фотографий\n        const imagesHTML = generatePhotoGridForFeed(post.images || [post.image]);\n\n        postElement.innerHTML = `\n            <div class=\"feed-card-header\">\n                <div class=\"feed-avatar\">${post.avatar || '\uD83D\uDC64'}</div>\n                <div class=\"feed-user-info\">\n                    <div class=\"feed-username\">${post.author || 'Путешественник'}</div>\n                    <div class=\"feed-timestamp\">${post.time || 'только что'}</div>\n                </div>\n            </div>\n            <div class=\"feed-card-content\">\n                <div class=\"feed-card-title\">${post.title}</div>\n                <div class=\"feed-card-text\">${post.text}</div>\n            </div>\n            <div class=\"feed-card-images\">\n                ${imagesHTML}\n            </div>\n            <div class=\"feed-card-footer\">\n                <button class=\"feed-action-btn\" onclick=\"toggleFeedLike(${post.id}, this)\">\n                    <span>❤\uFE0F</span>\n                    <span class=\"like-count\">${post.likes || 0}</span>\n                </button>\n            </div>\n        `;\n\n        // Анимация появления через CSS\n        postElement.style.animation = `fadeInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) ${index * 100 + 500}ms forwards`;\n        postElement.style.opacity = '0';\n\n        travelFeed.appendChild(postElement);\n    });\n}\n\n// Генерация photo grid для ленты\nfunction generatePhotoGridForFeed(images) {\n    if (!images || images.length === 0) {\n        return '';\n    }\n\n    if (images.length === 1) {\n        return `<img src=\"${images[0]}\" class=\"single-image\" loading=\"lazy\">`;\n    }\n\n    if (images.length === 2) {\n        return `\n            <div class=\"grid-two\">\n                ${images.map(img => `<img src=\"${img}\" class=\"grid-image\" loading=\"lazy\">`).join('')}\n            </div>\n        `;\n    }\n\n    if (images.length === 3) {\n        return `\n            <div class=\"grid-three\">\n                <img src=\"${images[0]}\" class=\"grid-image\" loading=\"lazy\">\n                <div class=\"grid-column\">\n                    <img src=\"${images[1]}\" class=\"grid-image\" loading=\"lazy\">\n                    <img src=\"${images[2]}\" class=\"grid-image\" loading=\"lazy\">\n                </div>\n            </div>\n        `;\n    }\n\n    if (images.length >= 4) {\n        return `\n            <div class=\"grid-many\">\n                <img src=\"${images[0]}\" class=\"grid-image\" loading=\"lazy\">\n                <img src=\"${images[1]}\" class=\"grid-image\" loading=\"lazy\">\n                <img src=\"${images[2]}\" class=\"grid-image\" loading=\"lazy\">\n                <div class=\"grid-more\">\n                    <img src=\"${images[3]}\" class=\"grid-image\" loading=\"lazy\">\n                    ${images.length > 4 ? `<div class=\"more-overlay\">+${images.length - 4}</div>` : ''}\n                </div>\n            </div>\n        `;\n    }\n}\n\n// Переключение лайка в ленте\nfunction toggleFeedLike(postId, button) {\n    const post = globalTravelFeed.find(p => p.id === postId);\n    if (!post) return;\n\n    post.likes = (post.likes || 0) + (button.classList.contains('liked') ? -1 : 1);\n    button.classList.toggle('liked');\n    button.querySelector('.like-count').textContent = post.likes;\n}\n\n// Функция загрузки пакетов путешествий перенесена в packages.js\n// Используем функции из packages.js: loadTravelPackages(), showPackageModal()\n\n// Функция показа уведомлений с поддержкой accessibility\nfunction showToast(message, duration = 3000) {\n    const toast = document.createElement('div');\n    toast.className = 'matryoshka-toast';\n    toast.textContent = message;\n\n    // Добавляем ARIA атрибуты для accessibility\n    toast.setAttribute('role', 'alert');\n    toast.setAttribute('aria-live', 'polite');\n    toast.setAttribute('aria-atomic', 'true');\n\n    Object.assign(toast.style, {\n        position: 'fixed',\n        bottom: '20px',\n        left: '50%',\n        transform: 'translateX(-50%)',\n        background: 'linear-gradient(135deg, #ffcc00, #ff8e53)',\n        color: '#1a1a2e',\n        padding: '12px 24px',\n        borderRadius: '12px',\n        fontWeight: '600',\n        fontSize: '14px',\n        zIndex: '10000',\n        boxShadow: '0 8px 32px rgba(255, 204, 0, 0.3)',\n        animation: 'fadeInUp 0.3s ease-out',\n        maxWidth: '90%',\n        textAlign: 'center'\n    });\n\n    document.body.appendChild(toast);\n\n    // Автоматически удаляем после duration\n    const timeoutId = setTimeout(() => {\n        toast.style.animation = 'fadeOut 0.3s ease-out forwards';\n        setTimeout(() => {\n            if (toast.parentNode) {\n                toast.remove();\n            }\n        }, 300);\n    }, duration);\n\n    // Добавляем возможность закрыть по клику\n    toast.addEventListener('click', () => {\n        clearTimeout(timeoutId);\n        toast.style.animation = 'fadeOut 0.3s ease-out forwards';\n        setTimeout(() => {\n            if (toast.parentNode) {\n                toast.remove();\n            }\n        }, 300);\n    });\n\n    // Добавляем курсор pointer для подсказки что можно кликнуть\n    toast.style.cursor = 'pointer';\n}\n\n// Функция добавления поста в ленту\nfunction addToGlobalFeed(travel) {\n    const user = window.Telegram?.WebApp?.initDataUnsafe?.user || {};\n    const userName = user.first_name || 'Путешественник';\n\n    const newPost = {\n        id: Date.now(),\n        author: userName,\n        avatar: '\uD83D\uDC64',\n        time: 'только что',\n        title: travel.title,\n        image: travel.image,\n        text: travel.text\n    };\n\n    // Добавляем в начало ленты\n    globalTravelFeed.unshift(newPost);\n\n    // Перезагружаем ленту\n    loadTravelFeed();\n\n    console.log('\uD83C\uDF1F Путешествие добавлено в ленту:', newPost);\n}\n\n// ========================================\n// УПРАВЛЕНИЕ ВИДИМОСТЬЮ СЕКЦИИ КОМАНДЫ\n// ========================================\n\n/**\n * Обновляет видимость секции команды\n * Команда видна только на главной странице\n */\nfunction updateTeamVisibility() {\n    const teamSection = document.querySelector('.team-section');\n    const mainSection = document.getElementById('mainSection');\n\n    if (!teamSection) return;\n\n    // Показываем команду только если главная страница видна\n    if (mainSection && mainSection.style.display !== 'none') {\n        teamSection.style.display = 'block';\n    } else {\n        teamSection.style.display = 'none';\n    }\n}\n\n// Функция показа деталей региона\nfunction showRegionDetails(regionId) {\n    const region = russiaRegions.find(r => r.id === regionId);\n    if (!region) return;\n\n    // Сохраняем ID текущего региона\n    window.currentRegionId = regionId;\n\n    // Показываем лоадер\n    showLoader('Загрузка информации о регионе...');\n\n    setTimeout(() => {\n        try {\n            // Скрываем главную страницу\n            const mainSection = document.getElementById('mainSection');\n            if (mainSection) mainSection.style.display = 'none';\n\n            // Показываем детали региона\n            const detailsSection = document.getElementById('regionDetails');\n            if (detailsSection) detailsSection.style.display = 'block';\n\n            // Скрываем команду\n            updateTeamVisibility();\n\n            // Заполняем данные\n            const regionTitle = document.getElementById('regionTitle');\n            const regionDescription = document.getElementById('regionDescription');\n            const regionImage = document.getElementById('regionImage');\n            const regionAbout = document.getElementById('regionAbout');\n\n            if (regionTitle) regionTitle.innerHTML = `${region.emoji} ${region.name}`;\n            if (regionDescription) regionDescription.textContent = region.description;\n            if (regionImage) regionImage.src = region.image;\n            if (regionAbout) regionAbout.textContent = region.about;\n\n            // Обновляем breadcrumbs\n            updateBreadcrumbs(region.name);\n\n            // Заполняем достопримечательности\n            loadAttractions(region.attractions);\n\n            // Загружаем партнеров\n            loadPartners(region.partners);\n\n            // Загружаем интерактивную карту 2GIS\n            load2GISMap(region).catch(mapError => {\n                console.warn('⚠\uFE0F Ошибка загрузки карты:', mapError);\n                // Fallback к старой системе\n                loadMapFallback(region);\n            });\n\n            hideLoader();\n\n            // Показываем BackButton в Telegram\n            if (tg && tg.BackButton) {\n                tg.BackButton.show();\n            }\n\n            // Уведомление Telegram\n            if (tg && tg.HapticFeedback) {\n                tg.HapticFeedback.impactOccurred('light');\n            }\n\n            // Скроллим наверх\n            window.scrollTo({ top: 0, behavior: 'smooth' });\n        } catch (error) {\n            console.error('❌ Ошибка отображения региона:', error);\n            hideLoader();\n        }\n    }, 800);\n}\n\n// Функция загрузки достопримечательностей (скрытое описание с кнопкой раскрыть)\nfunction loadAttractions(attractions) {\n    const attractionsList = document.getElementById('attractionsList');\n    if (!attractionsList) return;\n\n    attractionsList.innerHTML = '';\n    attractions.forEach((attraction, index) => {\n        const li = document.createElement('li');\n        const uniqueId = `attraction-${index}`;\n        li.innerHTML = `\n            <div class=\"attraction-header\">\n                <span class=\"attraction-name\">${attraction.name}</span>\n                <button class=\"action-btn route-btn\" onclick=\"openRoute('${attraction.name}')\">\n                    <span class=\"route-icon\">\uD83D\uDDFA\uFE0F</span>\n                    <span class=\"route-text\">Маршрут</span>\n                </button>\n            </div>\n            <div class=\"attraction-info-auto\" id=\"${uniqueId}\" style=\"display: none;\">${attraction.info}</div>\n            <button class=\"toggle-description-btn\" onclick=\"toggleAttractionDescription('${uniqueId}', this)\">\n                <span class=\"toggle-icon\">▼</span>\n                <span class=\"toggle-text\">Раскрыть описание</span>\n            </button>\n        `;\n        li.style.opacity = '0';\n        li.style.transform = 'translateX(-30px)';\n        attractionsList.appendChild(li);\n\n        // Анимация появления через CSS\n        li.style.animation = `fadeInLeft 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) ${index * 100}ms forwards`;\n    });\n}\n\n// Функция переключения видимости описания достопримечательности\nfunction toggleAttractionDescription(elementId, button) {\n    const infoElement = document.getElementById(elementId);\n    const icon = button.querySelector('.toggle-icon');\n    const text = button.querySelector('.toggle-text');\n\n    if (infoElement.style.display === 'none') {\n        infoElement.style.display = 'block';\n        infoElement.style.animation = 'fadeInUp 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';\n        icon.textContent = '▲';\n        text.textContent = 'Скрыть описание';\n    } else {\n        infoElement.style.display = 'none';\n        icon.textContent = '▼';\n        text.textContent = 'Раскрыть описание';\n    }\n}\n\n// Функция загрузки партнеров с QR-кодами\nfunction loadPartners(partners) {\n    const partnersGrid = document.getElementById('partnersGrid');\n    if (!partnersGrid) return;\n\n    partnersGrid.innerHTML = '';\n\n    // Сохраняем партнеров в глобальную переменную для доступа из общей кнопки\n    window.currentPartners = partners;\n\n    // Проверяем статус оплаты для текущего региона\n    const currentRegionId = getCurrentRegionId();\n    const isPaid = isRegionPaid(currentRegionId);\n\n    partners.forEach((partner, index) => {\n        const card = document.createElement('div');\n        card.className = 'partner-card';\n\n        // Создаем кнопку QR для каждого партнера\n        const qrButtonHTML = isPaid\n            ? `<button class=\"partner-qr-btn\" onclick='showPartnerQRByName(\"${partner.name.replace(/'/g, \"\\\\'\")}\",\"${partner.emoji}\")'>\n                   <span class=\"qr-btn-icon\">\uD83D\uDCF1</span>\n                   <span class=\"qr-btn-text\">Показать QR</span>\n               </button>`\n            : `<button class=\"partner-qr-btn disabled\" disabled title=\"Оплатите доступ для получения QR-кода\">\n                   <span class=\"qr-btn-icon\">\uD83D\uDD12</span>\n                   <span class=\"qr-btn-text\">Показать QR</span>\n               </button>`;\n\n        card.innerHTML = `\n            <div class=\"partner-image\">${partner.emoji}</div>\n            <div class=\"partner-info\">\n                <div class=\"partner-name\">${partner.name}</div>\n                <div class=\"partner-type\">${partner.type}</div>\n                <div class=\"partner-description\">${partner.description}</div>\n                <div class=\"partner-rating\">\n                    <span>⭐</span>\n                    <span>${partner.rating}</span>\n                </div>\n                <button class=\"partner-route-btn\" data-partner-index=\"${index}\">\n                    <span class=\"route-icon\">\uD83D\uDDFA\uFE0F</span>\n                    <span class=\"route-text\">Маршрут, отзывы, время работы</span>\n                </button>\n                ${qrButtonHTML}\n            </div>\n        `;\n        card.style.opacity = '0';\n        card.style.transform = 'translateY(30px)';\n        partnersGrid.appendChild(card);\n\n        // Добавляем обработчик для кнопки маршрута\n        const routeBtn = card.querySelector('.partner-route-btn');\n        routeBtn.addEventListener('click', () => {\n            openPartnerRoute(partner);\n        });\n\n        // Анимация появления\n        setTimeout(() => {\n            card.style.transition = 'all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';\n            card.style.opacity = '1';\n            card.style.transform = 'translateY(0)';\n        }, index * 100);\n    });\n\n    // Добавляем кнопки оплаты внизу только если еще не оплачено\n    if (!isPaid) {\n        const buttonsContainer = document.createElement('div');\n        buttonsContainer.className = 'partners-buttons-container';\n        buttonsContainer.innerHTML = `\n            <button class=\"partners-pay-btn\" onclick=\"showPaymentModal()\">\n                <span class=\"pay-btn-icon\">\uD83D\uDCB3</span>\n                <span class=\"pay-btn-text\">Оплатить пакет региона</span>\n                <span class=\"pay-btn-price\">300 ₽</span>\n            </button>\n            <button class=\"partners-demo-btn\" onclick=\"demoPurchase()\">\n                <span class=\"demo-btn-icon\">✨</span>\n                <span class=\"demo-btn-text\">Демо-покупка</span>\n            </button>\n        `;\n        partnersGrid.appendChild(buttonsContainer);\n    }\n}\n\n// Функция показа QR для конкретного партнера по имени\nfunction showPartnerQRByName(partnerName, partnerEmoji) {\n    console.log('\uD83D\uDD32 Показываем QR для партнера:', partnerName);\n\n    // Используем систему QR\n    if (typeof showQRModal === 'function') {\n        showQRModal(partnerName, partnerEmoji);\n    } else if (window.matryoshkaQR) {\n        // Fallback на полноценную систему QR\n        const partner = window.currentPartners?.find(p => p.name === partnerName);\n        if (partner) {\n            window.matryoshkaQR.showQRCode(partner);\n        }\n    } else {\n        // Последний fallback\n        showStaticQR(partnerName);\n    }\n}\n\n// Функция показа QR для всех партнеров (оставляем для совместимости)\nfunction showAllPartnersQR() {\n    const partners = window.currentPartners || [];\n\n    if (partners.length === 0) {\n        showToast('❌ Партнеры не найдены');\n        return;\n    }\n\n    console.log('\uD83D\uDD32 Показываем общий QR-код для партнеров');\n\n    // Используем полноценную систему QR от matryoshkaQR\n    if (window.matryoshkaQR) {\n        // Можно показать QR для первого партнера или создать общий QR\n        window.matryoshkaQR.showQRCode(partners[0]);\n    } else {\n        // Fallback на простой QR\n        showStaticQR('Партнеры региона');\n    }\n}\n\n// Функция показа статического QR кода\nfunction showStaticQR(partnerName) {\n    console.log('\uD83D\uDD32 Показываем QR-код для:', partnerName);\n\n    // Создаем контейнер для QR кода если его нет\n    let qrContainer = document.getElementById('staticQRContainer');\n    if (!qrContainer) {\n        qrContainer = document.createElement('div');\n        qrContainer.id = 'staticQRContainer';\n        qrContainer.style.cssText = `\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.85);\n            backdrop-filter: blur(10px);\n            z-index: 2000;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        `;\n        document.body.appendChild(qrContainer);\n    }\n\n    qrContainer.innerHTML = `\n        <div style=\"\n            background: rgba(15, 5, 32, 0.98);\n            border: 2px solid rgba(255, 204, 0, 0.4);\n            border-radius: 24px;\n            padding: 30px;\n            text-align: center;\n            box-shadow: 0 16px 64px rgba(0,0,0,0.6);\n            max-width: 90%;\n            transform: scale(0.9);\n            transition: transform 0.3s ease;\n        \">\n            <div style=\"color: #ffcc00; font-weight: 700; margin-bottom: 15px; font-size: 1.2rem;\">\n                ${partnerName}\n            </div>\n            <img\n                src=\"./city_photos/1614355077_html_c2a765adeec0a9fd.png\"\n                alt=\"QR Code\"\n                style=\"width: 200px; height: 200px; border-radius: 12px; background: white; padding: 10px;\"\n            />\n            <div style=\"color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 12px;\">\n                Отсканируйте для получения информации\n            </div>\n            <button\n                onclick=\"closeStaticQR()\"\n                style=\"\n                    margin-top: 20px;\n                    background: linear-gradient(135deg, rgba(255, 204, 0, 0.2), rgba(255, 107, 107, 0.2));\n                    border: 1px solid rgba(255, 204, 0, 0.4);\n                    color: white;\n                    padding: 12px 24px;\n                    border-radius: 12px;\n                    cursor: pointer;\n                    font-size: 0.95rem;\n                    font-weight: 600;\n                    transition: all 0.3s ease;\n                \"\n                onmouseover=\"this.style.background='linear-gradient(135deg, rgba(255, 204, 0, 0.3), rgba(255, 107, 107, 0.3))'\"\n                onmouseout=\"this.style.background='linear-gradient(135deg, rgba(255, 204, 0, 0.2), rgba(255, 107, 107, 0.2))'\"\n            >\n                Закрыть\n            </button>\n        </div>\n    `;\n\n    // Показываем с анимацией\n    setTimeout(() => {\n        qrContainer.style.opacity = '1';\n        const innerDiv = qrContainer.querySelector('div > div');\n        if (innerDiv) innerDiv.style.transform = 'scale(1)';\n    }, 50);\n\n    // Закрытие по клику на фон\n    qrContainer.onclick = (e) => {\n        if (e.target === qrContainer) {\n            closeStaticQR();\n        }\n    };\n}\n\n// Функция закрытия статического QR кода\nfunction closeStaticQR() {\n    const qrContainer = document.getElementById('staticQRContainer');\n    if (qrContainer) {\n        qrContainer.style.opacity = '0';\n        setTimeout(() => {\n            qrContainer.remove();\n        }, 300);\n    }\n}\n\n// Функция показа QR-кода партнера\nfunction showPartnerQR(partnerData) {\n    if (window.matryoshkaQR) {\n        // Добавляем анимацию нажатия кнопки\n        const btn = event.target;\n        btn.style.transform = 'scale(0.95)';\n        setTimeout(() => {\n            btn.style.transform = '';\n        }, 150);\n\n        // Показываем QR-код\n        window.matryoshkaQR.showQRCode(partnerData);\n\n        console.log('\uD83D\uDD32 Показываем QR для:', partnerData.name);\n    } else {\n        console.error('❌ QR система не загружена');\n        showToast('❌ QR-код временно недоступен');\n    }\n}\n\n\n// Функция открытия маршрута для достопримечательности\nfunction openRoute(attractionName) {\n    // Получаем данные текущего региона\n    const currentRegionId = getCurrentRegionId();\n    const regionData = window.RUSSIA_REGIONS_DATA?.[currentRegionId];\n\n    if (!regionData) {\n        console.error('Регион не найден');\n        return;\n    }\n\n    // Ищем достопримечательность\n    const attraction = regionData.attractions.find(a => a.name === attractionName);\n\n    // Показываем модальное окно выбора навигации\n    showNavigationChoice({\n        name: attractionName,\n        coordinates: attraction?.coordinates,\n        type: 'attraction'\n    });\n}\n\n// Функция открытия маршрута для партнера\nfunction openPartnerRoute(partner) {\n    console.log('\uD83D\uDDFA\uFE0F Открываем маршрут для партнера:', partner.name);\n\n    // Показываем модальное окно выбора навигации\n    showNavigationChoice({\n        name: partner.name,\n        coordinates: partner.coordinates,\n        type: 'partner'\n    });\n}\n\n// Функция показа модального окна выбора навигации\nfunction showNavigationChoice(place) {\n    console.log('\uD83D\uDDFA\uFE0F showNavigationChoice вызвана для:', place);\n    console.log('\uD83D\uDCCD Координаты:', place.coordinates);\n\n    // Создаем модальное окно\n    const modal = document.createElement('div');\n    modal.id = 'navigationModal';\n    modal.className = 'navigation-modal';\n    modal.setAttribute('data-auto-modal', ''); // Авто-инициализация ModalManager\n    modal.innerHTML = `\n        <div class=\"navigation-modal-overlay\"></div>\n        <div class=\"navigation-modal-content\">\n            <button class=\"navigation-modal-close\">✕</button>\n\n            <div class=\"navigation-modal-header\">\n                <h3 class=\"navigation-modal-title\">\uD83D\uDDFA\uFE0F Выберите навигацию</h3>\n                <p class=\"navigation-modal-subtitle\">${place.name}</p>\n            </div>\n\n            <div class=\"navigation-options\">\n                <button class=\"navigation-option\" data-nav=\"2gis\">\n                    <div class=\"navigation-option-icon\" style=\"background: linear-gradient(135deg, #00a650, #008f45);\">\n                        <svg width=\"40\" height=\"40\" viewBox=\"0 0 40 40\" fill=\"white\">\n                            <path d=\"M20 10C16.13 10 13 13.13 13 17c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/>\n                        </svg>\n                    </div>\n                    <div class=\"navigation-option-info\">\n                        <div class=\"navigation-option-name\">2GIS</div>\n                        <div class=\"navigation-option-desc\">Карты и навигация</div>\n                    </div>\n                </button>\n\n                <button class=\"navigation-option\" data-nav=\"yandex\">\n                    <div class=\"navigation-option-icon\" style=\"background: linear-gradient(135deg, #fc3f1d, #ff0000);\">\n                        <svg width=\"40\" height=\"40\" viewBox=\"0 0 40 40\" fill=\"white\">\n                            <text x=\"50%\" y=\"55%\" text-anchor=\"middle\" font-size=\"24\" font-weight=\"bold\" font-family=\"Arial\">Я</text>\n                        </svg>\n                    </div>\n                    <div class=\"navigation-option-info\">\n                        <div class=\"navigation-option-name\">Яндекс.Карты</div>\n                        <div class=\"navigation-option-desc\">Маршруты и навигация</div>\n                    </div>\n                </button>\n            </div>\n        </div>\n    `;\n\n    document.body.appendChild(modal);\n    console.log('✅ Модальное окно добавлено в DOM');\n\n    // Добавляем обработчики событий\n    const overlay = modal.querySelector('.navigation-modal-overlay');\n    const closeBtn = modal.querySelector('.navigation-modal-close');\n    const btn2gis = modal.querySelector('[data-nav=\"2gis\"]');\n    const btnYandex = modal.querySelector('[data-nav=\"yandex\"]');\n\n    overlay.addEventListener('click', closeNavigationModal);\n    closeBtn.addEventListener('click', closeNavigationModal);\n\n    btn2gis.addEventListener('click', () => {\n        console.log('\uD83D\uDDFA\uFE0F Клик по 2GIS');\n        openIn2GIS(place.name, place.coordinates);\n    });\n\n    btnYandex.addEventListener('click', () => {\n        console.log('\uD83D\uDDFA\uFE0F Клик по Yandex');\n        openInYandex(place.name, place.coordinates);\n    });\n\n    // Анимация появления\n    setTimeout(() => {\n        modal.classList.add('active');\n        console.log('✅ Класс \"active\" добавлен, модальное окно должно быть видимым');\n    }, 10);\n}\n\n// Функция закрытия модального окна навигации\nfunction closeNavigationModal() {\n    const modal = document.getElementById('navigationModal');\n    if (modal) {\n        modal.classList.remove('active');\n        setTimeout(() => {\n            modal.remove();\n        }, 300);\n    }\n}\n\n// Функция открытия в 2GIS\nfunction openIn2GIS(placeName, coordinates) {\n    closeNavigationModal();\n\n    // Всегда используем поиск по названию + город (как у достопримечательностей)\n    const regionData = window.RUSSIA_REGIONS_DATA?.[getCurrentRegionId()];\n    const cityName = regionData?.name || '';\n    const searchQuery = encodeURIComponent(`${placeName} ${cityName}`);\n    const url = `https://2gis.ru/search/${searchQuery}`;\n\n    window.open(url, '_blank');\n    console.log('\uD83D\uDDFA\uFE0F Открываем 2GIS:', url);\n    showToast('\uD83D\uDDFA\uFE0F Открываем 2GIS');\n}\n\n// Функция открытия в Яндекс.Картах\nfunction openInYandex(placeName, coordinates) {\n    closeNavigationModal();\n\n    // Всегда используем поиск по названию + город (как у достопримечательностей)\n    const regionData = window.RUSSIA_REGIONS_DATA?.[getCurrentRegionId()];\n    const cityName = regionData?.name || '';\n    const searchQuery = encodeURIComponent(`${placeName} ${cityName}`);\n    const url = `https://yandex.ru/maps/?text=${searchQuery}`;\n\n    window.open(url, '_blank');\n    console.log('\uD83D\uDDFA\uFE0F Открываем Яндекс.Карты:', url);\n    showToast('\uD83D\uDDFA\uFE0F Открываем Яндекс.Карты');\n}\n\n// Функция получения текущего региона\nfunction getCurrentRegionId() {\n    // Пытаемся получить из URL или глобальной переменной\n    if (window.currentRegionId) {\n        return window.currentRegionId;\n    }\n    return null;\n}\n\n// ========================================\n// СИСТЕМА ОПЛАТЫ РЕГИОНОВ\n// ========================================\n\n// Инициализация хранилища оплаченных регионов из sessionStorage\nfunction initPaidRegions() {\n    const saved = localStorage.getItem('paidRegions');\n    if (saved) {\n        try {\n            const data = JSON.parse(saved);\n            // Поддержка старого формата (массив ID)\n            if (Array.isArray(data) && data.length > 0 && typeof data[0] === 'string') {\n                // Конвертируем старый формат в новый\n                window.paidRegions = data.map(id => ({\n                    id,\n                    purchaseDate: new Date().toISOString(),\n                    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()\n                }));\n                // Сохраняем в новом формате\n                localStorage.setItem('paidRegions', JSON.stringify(window.paidRegions));\n            } else {\n                window.paidRegions = data;\n            }\n\n            // Фильтруем истекшие\n            const now = new Date();\n            window.paidRegions = window.paidRegions.filter(region => {\n                return new Date(region.expiresAt) > now;\n            });\n\n            // Сохраняем отфильтрованный список\n            localStorage.setItem('paidRegions', JSON.stringify(window.paidRegions));\n        } catch (e) {\n            window.paidRegions = [];\n        }\n    } else {\n        window.paidRegions = [];\n    }\n}\n\n// Инициализируем при загрузке\ninitPaidRegions();\n\n// Проверка, оплачен ли регион\nfunction isRegionPaid(regionId) {\n    initPaidRegions(); // Всегда загружаем актуальные данные и фильтруем истекшие\n    return window.paidRegions.some(region => region.id === regionId);\n}\n\n// Отметить регион как оплаченный\nfunction markRegionAsPaid(regionId) {\n    initPaidRegions(); // Загружаем актуальные данные\n\n    // Проверяем, не оплачен ли уже этот регион\n    const existingRegion = window.paidRegions.find(r => r.id === regionId);\n    if (existingRegion) {\n        const expiresDate = new Date(existingRegion.expiresAt).toLocaleDateString('ru-RU');\n        showToast(`Регион уже оплачен до ${expiresDate}`, 3000);\n        return;\n    }\n\n    // Добавляем новый регион со сроком действия 7 дней\n    const purchaseDate = new Date();\n    const expiresAt = new Date(purchaseDate);\n    expiresAt.setDate(expiresAt.getDate() + 7);\n\n    const paidRegion = {\n        id: regionId,\n        purchaseDate: purchaseDate.toISOString(),\n        expiresAt: expiresAt.toISOString()\n    };\n\n    window.paidRegions.push(paidRegion);\n\n    // Сохраняем в sessionStorage\n    localStorage.setItem('paidRegions', JSON.stringify(window.paidRegions));\n    console.log('✅ Регион оплачен и сохранен:', regionId, paidRegion);\n}\n\n// Показать модальное окно оплаты\nfunction showPaymentModal() {\n    const currentRegionId = getCurrentRegionId();\n    const regionData = window.RUSSIA_REGIONS_DATA?.[currentRegionId];\n    const regionName = regionData?.name || 'региона';\n\n    const modal = document.createElement('div');\n    modal.id = 'paymentModal';\n    modal.className = 'payment-modal';\n    modal.setAttribute('data-auto-modal', ''); // Авто-инициализация ModalManager\n    modal.innerHTML = `\n        <div class=\"payment-modal-overlay\"></div>\n        <div class=\"payment-modal-content\">\n            <button class=\"payment-modal-close\" onclick=\"closePaymentModal()\">✕</button>\n\n            <div class=\"payment-modal-header\">\n                <h3 class=\"payment-modal-title\">\uD83D\uDCB3 Оплата доступа</h3>\n                <p class=\"payment-modal-subtitle\">Пакет партнеров: ${regionName}</p>\n                <div class=\"payment-modal-price\">300 ₽</div>\n            </div>\n\n            <form class=\"payment-form\" onsubmit=\"processPayment(event)\">\n                <div class=\"payment-form-group\">\n                    <label class=\"payment-label\">Номер карты</label>\n                    <input\n                        type=\"text\"\n                        class=\"payment-input\"\n                        placeholder=\"0000 0000 0000 0000\"\n                        maxlength=\"19\"\n                        required\n                    >\n                </div>\n\n                <div class=\"payment-form-row\">\n                    <div class=\"payment-form-group\">\n                        <label class=\"payment-label\">Срок действия</label>\n                        <input\n                            type=\"text\"\n                            class=\"payment-input\"\n                            placeholder=\"MM/YY\"\n                            maxlength=\"5\"\n                            required\n                        >\n                    </div>\n                    <div class=\"payment-form-group\">\n                        <label class=\"payment-label\">CVV</label>\n                        <input\n                            type=\"text\"\n                            class=\"payment-input\"\n                            placeholder=\"***\"\n                            maxlength=\"3\"\n                            required\n                        >\n                    </div>\n                </div>\n\n                <button type=\"submit\" class=\"payment-submit-btn\">\n                    <span class=\"payment-submit-icon\">\uD83D\uDCB3</span>\n                    <span class=\"payment-submit-text\">Оплатить 300 ₽</span>\n                </button>\n            </form>\n        </div>\n    `;\n\n    document.body.appendChild(modal);\n\n    // Анимация появления\n    setTimeout(() => {\n        modal.classList.add('active');\n    }, 10);\n\n    // Закрытие по клику на overlay\n    const overlay = modal.querySelector('.payment-modal-overlay');\n    overlay.addEventListener('click', closePaymentModal);\n}\n\n// Закрыть модальное окно оплаты\nfunction closePaymentModal() {\n    const modal = document.getElementById('paymentModal');\n    if (modal) {\n        modal.classList.remove('active');\n        setTimeout(() => {\n            modal.remove();\n        }, 300);\n    }\n}\n\n// Обработка оплаты\nfunction processPayment(event) {\n    event.preventDefault();\n\n    const currentRegionId = getCurrentRegionId();\n    const regionData = window.RUSSIA_REGIONS_DATA?.[currentRegionId];\n\n    // Имитация обработки платежа\n    showLoader('Обработка платежа...');\n\n    setTimeout(() => {\n        // Отмечаем регион как оплаченный\n        markRegionAsPaid(currentRegionId);\n\n        hideLoader();\n        closePaymentModal();\n\n        // Показываем уведомление об успешной оплате\n        showToast('✅ Оплата прошла успешно!', 3000);\n\n        // Перезагружаем партнеров для обновления кнопок\n        if (regionData && regionData.partners) {\n            loadPartners(regionData.partners);\n        }\n\n        // \uD83D\uDD25 ОБНОВЛЯЕМ КОРЗИНУ\n        if (window.matryoshkaCart) {\n            window.matryoshkaCart.refresh();\n            console.log('✅ Корзина обновлена после оплаты региона');\n        }\n\n        // Обновляем профиль если открыт\n        if (window.matryoshkaProfile && window.matryoshkaProfile.updateCoupons) {\n            window.matryoshkaProfile.updateCoupons();\n        }\n\n        // \uD83D\uDD25 КРИТИЧЕСКОЕ ИСПРАВЛЕНИЕ: Разблокируем скролл после оплаты\n        if (window.ensureScrollEnabled) {\n            window.ensureScrollEnabled();\n        }\n        document.body.style.overflow = 'auto';\n        document.body.style.position = 'static';\n        document.documentElement.style.overflow = 'auto';\n    }, 2000);\n}\n\n// Демо-покупка (мгновенная)\nfunction demoPurchase() {\n    const currentRegionId = getCurrentRegionId();\n    const regionData = window.RUSSIA_REGIONS_DATA?.[currentRegionId];\n\n    // Отмечаем регион как оплаченный\n    markRegionAsPaid(currentRegionId);\n\n    // Показываем уведомление\n    showToast('✅ Оплата прошла успешно! (Демо)', 3000);\n\n    // Перезагружаем партнеров для обновления кнопок\n    if (regionData && regionData.partners) {\n        loadPartners(regionData.partners);\n    }\n\n    // \uD83D\uDD25 ОБНОВЛЯЕМ КОРЗИНУ\n    if (window.matryoshkaCart) {\n        window.matryoshkaCart.refresh();\n        console.log('✅ Корзина обновлена после демо-покупки региона');\n    }\n\n    // Обновляем профиль если открыт\n    if (window.matryoshkaProfile && window.matryoshkaProfile.updateCoupons) {\n        window.matryoshkaProfile.updateCoupons();\n    }\n\n    // \uD83D\uDD25 КРИТИЧЕСКОЕ ИСПРАВЛЕНИЕ: Разблокируем скролл после покупки\n    if (window.ensureScrollEnabled) {\n        window.ensureScrollEnabled();\n    }\n    document.body.style.overflow = 'auto';\n    document.body.style.position = 'static';\n    document.documentElement.style.overflow = 'auto';\n}\n\n// Функция загрузки интерактивной карты 2GIS\nasync function load2GISMap(regionData) {\n    console.log('\uD83D\uDDFA\uFE0F load2GISMap вызвана с данными:', regionData);\n    console.log('\uD83D\uDCCB Партнёры в regionData:', regionData?.partners);\n    console.log('\uD83D\uDCCA Количество партнёров:', regionData?.partners?.length);\n\n    const mapContainer = document.getElementById('mapContainer');\n    if (!mapContainer) {\n        console.warn('⚠\uFE0F Контейнер карты не найден');\n        return;\n    }\n\n    // Показываем загрузчик\n    mapContainer.innerHTML = `\n        <div class=\"map-loading\">\n            <div class=\"map-loading-spinner\"></div>\n            <div class=\"map-loading-text\">Загружаем карту региона...</div>\n        </div>\n    `;\n\n    try {\n        // Создаем интерактивную карту через наш модуль\n        if (window.matryoshka2GIS) {\n            console.log('✅ Модуль matryoshka2GIS найден, вызываем createMap...');\n            await window.matryoshka2GIS.createMap(regionData, 'mapContainer');\n        } else {\n            throw new Error('Модуль карт не загружен');\n        }\n    } catch (error) {\n        console.error('❌ Ошибка загрузки карты:', error);\n        // Fallback к простой iframe карте\n        loadMapFallback(regionData);\n    }\n}\n\n// Функция загрузки карты (fallback)\nfunction loadMapFallback(regionData) {\n    const mapContainer = document.getElementById('mapContainer');\n    if (!mapContainer) return;\n\n    // Получаем центр региона\n    const center = getRegionCenterCoords(regionData.id);\n\n    mapContainer.innerHTML = `\n        <iframe\n            src=\"https://widgets.2gis.com/widget?id=DgWidget_map&opt=%7B%22pos%22%3A%7B%22lat%22%3A${center.lat}%2C%22lon%22%3A${center.lon}%2C%22zoom%22%3A${center.zoom}%7D%2C%22opt%22%3A%7B%22city%22%3A%22${regionData.name}%22%7D%7D\"\n            width=\"100%\"\n            height=\"100%\"\n            frameborder=\"0\"\n            allowfullscreen=\"\"\n            style=\"border-radius: 16px;\"\n        ></iframe>\n    `;\n}\n\n// Функция получения координат центра региона\nfunction getRegionCenterCoords(regionId) {\n    const centers = {\n        'moscow': { lat: 55.7558, lon: 37.6176, zoom: 10 },\n        'spb': { lat: 59.9311, lon: 30.3351, zoom: 10 },\n        'kazan': { lat: 55.7887, lon: 49.1221, zoom: 11 },\n        'sochi': { lat: 43.6028, lon: 39.7303, zoom: 11 },\n        'ekaterinburg': { lat: 56.8431, lon: 60.6122, zoom: 11 },\n        'volgograd': { lat: 48.7194, lon: 44.5018, zoom: 11 },\n        'irkutsk': { lat: 52.2978, lon: 104.2964, zoom: 11 },\n        'kaliningrad': { lat: 54.7065, lon: 20.5083, zoom: 11 },\n        'nizhnynovgorod': { lat: 56.2965, lon: 44.0020, zoom: 11 },\n        'chelyabinsk': { lat: 55.1644, lon: 61.4291, zoom: 11 },\n        'karachaevo': { lat: 43.7681, lon: 42.0577, zoom: 10 },\n        'stavropol': { lat: 45.0428, lon: 41.9734, zoom: 11 },\n        'yaroslavl': { lat: 57.6261, lon: 39.8844, zoom: 11 },\n        'kostroma': { lat: 57.7665, lon: 40.9266, zoom: 11 },\n        'kabardino': { lat: 43.4806, lon: 43.4917, zoom: 10 }\n    };\n\n    return centers[regionId] || { lat: 55.7558, lon: 37.6176, zoom: 10 };\n}\n\n// \uD83D\uDD25 УДАЛЕНО: Функции теперь определены ТОЛЬКО в navigation.js\n// Дублирование функций вызывало конфликты навигации\n\n// Функция показа лоадера\nfunction showLoader(text = 'Загрузка...') {\n    const loader = document.getElementById('loader');\n    const loaderText = document.getElementById('loaderText');\n\n    if (loader) loader.classList.add('active');\n    if (loaderText) loaderText.textContent = text;\n}\n\n// Функция скрытия лоадера\nfunction hideLoader() {\n    const loader = document.getElementById('loader');\n    if (loader) loader.classList.remove('active');\n}\n\n\n// \uD83D\uDD25 УДАЛЕНО: Функции showProfile и hideProfile теперь определены ТОЛЬКО в navigation.js\n\n// Функция совместимости для старого кода (удалена встроенная версия)\n\n/**\n * \uD83D\uDD25 УДАЛЕНО: Лента путешествий больше не отображается на главной странице\n * Доступна через отдельную вкладку \"Лента\" в нижней навигации\n */\nfunction loadMainFeedSection() {\n    // Пустая функция для совместимости\n    console.log('ℹ\uFE0F Лента путешествий доступна через вкладку \"Лента\"');\n}\n\n// Инициализация приложения\ndocument.addEventListener('DOMContentLoaded', function() {\n    console.log('\uD83E\uDE86 Матрешка - инициализация приложения');\n\n    // Загружаем данные регионов\n    loadRegionsData();\n\n    // Отображаем информацию о пользователе\n    displayUserInfo();\n\n    // Загружаем регионы\n    loadRegions();\n\n    // Загружаем пакеты путешествий\n    setTimeout(() => {\n        loadTravelPackages();\n    }, 1000);\n\n    // \uD83D\uDD25 УДАЛЕНО: Лента путешествий больше не загружается на главную страницу\n\n    // \uD83D\uDD25 ВОССТАНАВЛИВАЕМ ПОСЛЕДНЮЮ АКТИВНУЮ ВКЛАДКУ\n    setTimeout(() => {\n        restoreActiveSection();\n    }, 500);\n\n    // Обработчик кнопки \"Назад\"\n    const backBtn = document.getElementById('backBtn');\n    if (backBtn) {\n        backBtn.addEventListener('click', goBack);\n    }\n\n    // \uD83D\uDD25 УДАЛЕНО: Обработчик для profileBackBtn уже есть в navigation.js\n\n    // Инициализация Telegram Web App\n    if (tg) {\n        console.log('✅ Telegram Web App готов к работе');\n\n        // Настройки главной кнопки\n        if (tg.MainButton) {\n            tg.MainButton.text = 'Главная';\n            tg.MainButton.onClick(() => goBack());\n        }\n    }\n\n    console.log('\uD83D\uDE80 Матрешка - приложение готово к работе');\n\n    // Скрываем лоадер после загрузки\n    hideLoader();\n});\n// ========================================\n// BREADCRUMBS НАВИГАЦИЯ\n// ========================================\n\nfunction updateBreadcrumbs(regionName) {\n    const breadcrumbRegion = document.getElementById('breadcrumbRegion');\n    if (breadcrumbRegion && regionName) {\n        breadcrumbRegion.textContent = regionName;\n    }\n}\n\n// ========================================\n// ФУНКЦИИ ДЛЯ КОРЗИНЫ И НИЖНЕЙ НАВИГАЦИИ\n// ========================================\n\n// \uD83D\uDD25 УДАЛЕНО: Функции showCart, hideCart, showFeed теперь определены ТОЛЬКО в navigation.js\n\n/**\n * Обновление активной кнопки в нижней навигации\n */\nfunction updateBottomNav(activePage) {\n    const navItems = document.querySelectorAll('.nav-item');\n    navItems.forEach(item => {\n        if (item.dataset.page === activePage) {\n            item.classList.add('active');\n        } else {\n            item.classList.remove('active');\n        }\n    });\n}\n\n// \uD83D\uDD25 УДАЛЕНО: Обработчик для cartBackBtn уже есть в navigation.js\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/scripts/script.js b/scripts/script.js
--- a/scripts/script.js	(revision 8f6d951bebaad31c3e38bcab0f58b81da2f711d9)
+++ b/scripts/script.js	(date 1764921438169)
@@ -311,73 +311,41 @@
     }
 }
 
-// Создание карточки региона с ТУРБО-ОПТИМИЗАЦИЕЙ + ACETERNITY EFFECTS
+// Создание карточки региона с ACETERNITY UI (мобильная версия)
 function createRegionCard(region, animationIndex) {
-    const regionCard = document.createElement('div');
-    regionCard.className = 'region-card aceternity-card spotlight-container ripple';
-    regionCard.onclick = () => showRegionDetails(region.id);
-
-    // Добавляем spotlight эффект
-    const spotlight = document.createElement('div');
-    spotlight.className = 'spotlight';
-    regionCard.appendChild(spotlight);
-
-    // 3D tilt эффект при движении мыши
-    regionCard.addEventListener('mousemove', (e) => {
-        const rect = regionCard.getBoundingClientRect();
-        const x = ((e.clientX - rect.left) / rect.width - 0.5) * 20;
-        const y = ((e.clientY - rect.top) / rect.height - 0.5) * -20;
-        regionCard.style.setProperty('--mouse-x', `${x}deg`);
-        regionCard.style.setProperty('--mouse-y', `${y}deg`);
-
-        // Перемещаем spotlight
-        spotlight.style.left = `${e.clientX - rect.left - 200}px`;
-        spotlight.style.top = `${e.clientY - rect.top - 200}px`;
-    });
+    // Создаем контейнер для компонента
+    const container = document.createElement('div');
+    container.className = 'region-card-container';
+    container.id = `region-card-${region.id}`;
 
-    regionCard.addEventListener('mouseleave', () => {
-        regionCard.style.setProperty('--mouse-x', '0deg');
-        regionCard.style.setProperty('--mouse-y', '0deg');
-    });
-
-    // Создаем img элемент отдельно для оптимизации
-    const img = document.createElement('img');
-    img.className = 'region-image';
-    img.alt = region.name;
-    img.loading = 'lazy';
-
-    // Используем Performance Optimizer для мгновенной загрузки
-    if (window.performanceOptimizer) {
-        // Определяем приоритет: первые 3 карточки - высокий
-        const priority = animationIndex < 3 ? 'high' : 'normal';
-
-        // Мгновенная загрузка через оптимизатор
-        window.performanceOptimizer.loadImageInstantly(region.image, img, priority);
+    // Используем новый мобильный компонент
+    if (typeof RegionCardMobile !== 'undefined') {
+        // Создаем компонент с реальными данными региона
+        new RegionCardMobile(container, {
+            title: region.name,
+            description: region.description,
+            emoji: region.emoji,
+            image: region.image,
+            regionId: region.id,
+            featured: region.featured || false,
+            tag: region.tag || null,
+            onClick: (regionId) => showRegionDetails(regionId)
+        });
     } else {
-        // Fallback
-        img.src = region.image;
-    }
-
-    // Создаем контент
-    const content = document.createElement('div');
-    content.className = 'region-content';
-    content.innerHTML = `
-        <div class="region-name">${region.name}</div>
-        <div class="region-description">${region.description}</div>
-        <div class="region-stats">
-            <span>👥 ${region.population}</span>
-            <span>📐 ${region.area}</span>
-        </div>
-    `;
-
-    regionCard.appendChild(img);
-    regionCard.appendChild(content);
+        // Fallback на старую версию если компонент не загружен
+        console.error('❌ RegionCardMobile не загружен, используем fallback');
+        container.className = 'region-card';
+        container.onclick = () => showRegionDetails(region.id);
+        container.innerHTML = `
+            <img class="region-image" src="${region.image}" alt="${region.name}" loading="lazy">
+            <div class="region-content">
+                <div class="region-name">${region.name}</div>
+                <div class="region-description">${region.description}</div>
+            </div>
+        `;
+    }
 
-    // Анимация появления
-    regionCard.style.animation = `fadeInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) ${(animationIndex % REGIONS_PER_PAGE) * 100}ms forwards`;
-    regionCard.style.opacity = '0';
-
-    return regionCard;
+    return container;
 }
 
 // Функция обновления кнопки "Показать больше"
@@ -723,35 +691,35 @@
     }, 800);
 }
 
-// Функция загрузки достопримечательностей (скрытое описание с кнопкой раскрыть)
+// Функция загрузки достопримечательностей (Aceternity Design)
 function loadAttractions(attractions) {
     const attractionsList = document.getElementById('attractionsList');
     if (!attractionsList) return;
 
     attractionsList.innerHTML = '';
     attractions.forEach((attraction, index) => {
-        const li = document.createElement('li');
-        const uniqueId = `attraction-${index}`;
-        li.innerHTML = `
-            <div class="attraction-header">
-                <span class="attraction-name">${attraction.name}</span>
-                <button class="action-btn route-btn" onclick="openRoute('${attraction.name}')">
-                    <span class="route-icon">🗺️</span>
-                    <span class="route-text">Маршрут</span>
-                </button>
-            </div>
-            <div class="attraction-info-auto" id="${uniqueId}" style="display: none;">${attraction.info}</div>
-            <button class="toggle-description-btn" onclick="toggleAttractionDescription('${uniqueId}', this)">
-                <span class="toggle-icon">▼</span>
-                <span class="toggle-text">Раскрыть описание</span>
+        const card = document.createElement('div');
+        card.className = 'attraction-card-aceternity';
+
+        card.innerHTML = `
+            <h3 class="attraction-name-aceternity">${attraction.name}</h3>
+            <p class="attraction-info-aceternity">${attraction.info}</p>
+            <button class="attraction-route-btn" onclick="openRoute('${attraction.name}')">
+                <span>🗺️</span>
+                <span>Построить маршрут</span>
             </button>
         `;
-        li.style.opacity = '0';
-        li.style.transform = 'translateX(-30px)';
-        attractionsList.appendChild(li);
 
-        // Анимация появления через CSS
-        li.style.animation = `fadeInLeft 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) ${index * 100}ms forwards`;
+        card.style.opacity = '0';
+        card.style.transform = 'translateY(20px)';
+        attractionsList.appendChild(card);
+
+        // Анимация появления
+        setTimeout(() => {
+            card.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
+            card.style.opacity = '1';
+            card.style.transform = 'translateY(0)';
+        }, index * 100);
     });
 }
 
@@ -773,14 +741,14 @@
     }
 }
 
-// Функция загрузки партнеров с QR-кодами
+// Функция загрузки партнеров (Aceternity Design)
 function loadPartners(partners) {
     const partnersGrid = document.getElementById('partnersGrid');
     if (!partnersGrid) return;
 
     partnersGrid.innerHTML = '';
 
-    // Сохраняем партнеров в глобальную переменную для доступа из общей кнопки
+    // Сохраняем партнеров в глобальную переменную
     window.currentPartners = partners;
 
     // Проверяем статус оплаты для текущего региона
@@ -789,49 +757,40 @@
 
     partners.forEach((partner, index) => {
         const card = document.createElement('div');
-        card.className = 'partner-card';
-
-        // Создаем кнопку QR для каждого партнера
-        const qrButtonHTML = isPaid
-            ? `<button class="partner-qr-btn" onclick='showPartnerQRByName("${partner.name.replace(/'/g, "\\'")}","${partner.emoji}")'>
-                   <span class="qr-btn-icon">📱</span>
-                   <span class="qr-btn-text">Показать QR</span>
-               </button>`
-            : `<button class="partner-qr-btn disabled" disabled title="Оплатите доступ для получения QR-кода">
-                   <span class="qr-btn-icon">🔒</span>
-                   <span class="qr-btn-text">Показать QR</span>
-               </button>`;
+        card.className = 'partner-card-aceternity';
 
         card.innerHTML = `
-            <div class="partner-image">${partner.emoji}</div>
-            <div class="partner-info">
-                <div class="partner-name">${partner.name}</div>
-                <div class="partner-type">${partner.type}</div>
-                <div class="partner-description">${partner.description}</div>
-                <div class="partner-rating">
+            <div class="partner-header-aceternity">
+                <div class="partner-emoji">${partner.emoji}</div>
+                <div class="partner-info">
+                    <h3 class="partner-name-aceternity">${partner.name}</h3>
+                    <p class="partner-type-aceternity">${partner.type}</p>
+                </div>
+            </div>
+            <p class="partner-description-aceternity">${partner.description}</p>
+            <div class="partner-footer-aceternity">
+                <div class="partner-rating-aceternity">
                     <span>⭐</span>
                     <span>${partner.rating}</span>
                 </div>
-                <button class="partner-route-btn" data-partner-index="${index}">
-                    <span class="route-icon">🗺️</span>
-                    <span class="route-text">Маршрут, отзывы, время работы</span>
-                </button>
-                ${qrButtonHTML}
+                <div class="partner-special-offer-aceternity">
+                    ${partner.specialOffer || partner.discount ? (partner.specialOffer || `Скидка ${partner.discount}%`) : 'Спецпредложение'}
+                </div>
             </div>
         `;
+
         card.style.opacity = '0';
-        card.style.transform = 'translateY(30px)';
+        card.style.transform = 'translateY(20px)';
         partnersGrid.appendChild(card);
 
-        // Добавляем обработчик для кнопки маршрута
-        const routeBtn = card.querySelector('.partner-route-btn');
-        routeBtn.addEventListener('click', () => {
+        // Добавляем обработчик клика
+        card.addEventListener('click', () => {
             openPartnerRoute(partner);
         });
 
         // Анимация появления
         setTimeout(() => {
-            card.style.transition = 'all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
+            card.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
             card.style.opacity = '1';
             card.style.transform = 'translateY(0)';
         }, index * 100);
@@ -1505,19 +1464,24 @@
 // 🔥 УДАЛЕНО: Функции теперь определены ТОЛЬКО в navigation.js
 // Дублирование функций вызывало конфликты навигации
 
-// Функция показа лоадера
+// Функция показа лоадера - обновлено для LoaderThree
 function showLoader(text = 'Загрузка...') {
     const loader = document.getElementById('loader');
-    const loaderText = document.getElementById('loaderText');
+    if (!loader) return;
 
-    if (loader) loader.classList.add('active');
+    // Ищем текстовый элемент (LoaderThree использует .loader-three-text)
+    const loaderText = loader.querySelector('.loader-three-text');
+
     if (loaderText) loaderText.textContent = text;
+    loader.classList.add('active');
 }
 
-// Функция скрытия лоадера
+// Функция скрытия лоадера - обновлено для LoaderThree
 function hideLoader() {
     const loader = document.getElementById('loader');
-    if (loader) loader.classList.remove('active');
+    if (!loader) return;
+
+    loader.classList.remove('active');
 }
 
 
@@ -1547,6 +1511,34 @@
     // Загружаем регионы
     loadRegions();
 
+    // 🔍 Инициализируем Aceternity-style поиск
+    if (typeof AceternitySearch !== 'undefined') {
+        new AceternitySearch('aceternitySearchContainer', {
+            placeholders: [
+                "Куда поедем в России? 🌍",
+                "Например: Байкал ⛰️",
+                "Например: Сочи 🏖️",
+                "Например: Казань 🕌",
+                "Например: Камчатка 🌋",
+                "Например: Алтай 🏔️",
+                "Например: Карелия 🌲",
+                "Например: Санкт-Петербург 🏛️",
+                "Например: Владивосток 🌊"
+            ],
+            placeholderInterval: 3000,
+            onSearch: (query) => {
+                console.log('🔍 Поиск:', query);
+                // Используем существующую функцию поиска
+                if (typeof searchRegions === 'function') {
+                    searchRegions(query);
+                }
+            },
+            vanishOnSubmit: true,
+            buttonText: "Найти",
+            minLength: 2
+        });
+    }
+
     // Загружаем пакеты путешествий
     setTimeout(() => {
         loadTravelPackages();
Index: styles/matreshka-optimized.css
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>/**\n * \uD83D\uDE80 MATRESHKA OPTIMIZED - Единый легкий CSS\n * Все стили в одном файле для максимальной производительности\n * Russian Heritage Theme + минимум анимаций\n */\n\n/* ========================================\n   RUSSIAN HERITAGE - Цветовая палитра\n   ======================================== */\n:root {\n    /* Основные цвета */\n    --gold: #C9A961;\n    --gold-dark: #B8984F;\n    --red: #B8312F;\n    --blue: #2E5266;\n    --brown: #8B4513;\n    --white: #F5F1E8;\n    --dark: #1a0e2e;\n    --dark-bg: #0a0118;\n\n    /* Spacing */\n    --space-2: 0.5rem;\n    --space-3: 0.75rem;\n    --space-4: 1rem;\n    --space-5: 1.5rem;\n    --space-6: 2rem;\n    --space-8: 3rem;\n\n    /* Radius */\n    --radius-md: 0.75rem;\n    --radius-lg: 1rem;\n    --radius-xl: 1.5rem;\n    --radius-2xl: 2rem;\n}\n\n/* ========================================\n   БАЗОВЫЕ СТИЛИ\n   ======================================== */\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n    background: var(--dark-bg) !important;\n    color: var(--white) !important;\n    line-height: 1.6;\n    -webkit-tap-highlight-color: transparent;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n    padding: 20px;\n}\n\n/* ========================================\n   HERO SECTION - Упрощенная\n   ======================================== */\n.hero-section {\n    position: relative;\n    min-height: 600px;\n    border-radius: var(--radius-2xl);\n    overflow: hidden;\n    background: linear-gradient(135deg, var(--dark) 0%, #1a0a3e 100%) !important;\n    border: 1px solid rgba(201, 169, 97, 0.2) !important;\n    margin-bottom: var(--space-8);\n}\n\n.hero-model-container {\n    position: absolute;\n    inset: 0;\n    opacity: 0.3;\n    pointer-events: none;\n}\n\n.hero-model-container iframe {\n    width: 100%;\n    height: 100%;\n    border: none;\n}\n\n.hero-overlay {\n    position: relative;\n    z-index: 1;\n    min-height: 600px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    padding: var(--space-8) var(--space-5);\n    background: linear-gradient(180deg, transparent 0%, rgba(10, 1, 24, 0.8) 100%);\n}\n\n.hero-title {\n    font-size: clamp(2rem, 8vw, 4rem) !important;\n    font-weight: 900 !important;\n    text-align: center;\n    margin-bottom: var(--space-6);\n    background: linear-gradient(135deg, var(--white) 0%, var(--gold) 100%) !important;\n    -webkit-background-clip: text !important;\n    -webkit-text-fill-color: transparent !important;\n    background-clip: text !important;\n}\n\n/* ========================================\n   DATE PICKER - Упрощенный\n   ======================================== */\n.travel-date-picker {\n    background: rgba(26, 14, 46, 0.8);\n    border: 1px solid rgba(201, 169, 97, 0.3);\n    border-radius: var(--radius-xl);\n    padding: var(--space-6);\n    max-width: 600px;\n    width: 100%;\n}\n\n.date-picker-header {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: var(--space-3);\n    margin-bottom: var(--space-5);\n}\n\n.date-icon {\n    font-size: 1.5rem;\n}\n\n.date-label {\n    font-size: 1.1rem;\n    font-weight: 600;\n}\n\n.date-inputs-row {\n    display: flex;\n    gap: var(--space-4);\n    margin-bottom: var(--space-5);\n}\n\n.date-input-group {\n    flex: 1;\n}\n\n.date-input-label {\n    display: block;\n    font-size: 0.85rem;\n    color: rgba(255, 255, 255, 0.7);\n    margin-bottom: var(--space-2);\n}\n\n.date-input {\n    width: 100%;\n    background: rgba(255, 255, 255, 0.1);\n    border: 1px solid rgba(201, 169, 97, 0.3);\n    border-radius: var(--radius-md);\n    padding: var(--space-3);\n    color: var(--white);\n    font-size: 1rem;\n}\n\n.date-input:focus {\n    outline: none;\n    border-color: var(--gold);\n}\n\n.date-separator {\n    align-self: flex-end;\n    padding-bottom: var(--space-3);\n    color: var(--gold);\n}\n\n.date-save-btn {\n    width: 100%;\n    background: linear-gradient(135deg, var(--gold) 0%, var(--red) 100%) !important;\n    color: var(--dark) !important;\n    border: none !important;\n    border-radius: var(--radius-md);\n    padding: var(--space-4);\n    font-size: 1rem !important;\n    font-weight: 700 !important;\n    cursor: pointer;\n}\n\n.date-save-btn:hover {\n    opacity: 0.9;\n}\n\n/* ========================================\n   SEARCH\n   ======================================== */\n.search-section {\n    margin: var(--space-6) 0;\n}\n\n.search-container {\n    max-width: 600px;\n    margin: 0 auto;\n    background: rgba(26, 14, 46, 0.6);\n    border: 1px solid rgba(201, 169, 97, 0.3);\n    border-radius: 50px;\n    padding: var(--space-3) var(--space-5);\n    display: flex;\n    align-items: center;\n    gap: var(--space-3);\n}\n\n.search-input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    color: var(--white);\n    font-size: 1rem;\n    outline: none;\n}\n\n.search-input::placeholder {\n    color: rgba(255, 255, 255, 0.5);\n}\n\n.search-clear {\n    background: transparent;\n    border: none;\n    color: rgba(255, 255, 255, 0.5);\n    cursor: pointer;\n    font-size: 1.2rem;\n}\n\n/* ========================================\n   REGION CARDS - Упрощенные\n   ======================================== */\n.regions-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n    gap: var(--space-5);\n    margin-top: var(--space-6);\n}\n\n.region-card {\n    background: rgba(26, 14, 46, 0.6);\n    border: 1px solid rgba(201, 169, 97, 0.2);\n    border-radius: var(--radius-xl);\n    overflow: hidden;\n    cursor: pointer;\n    transition: transform 0.3s ease, border-color 0.3s ease;\n}\n\n.region-card:hover {\n    transform: translateY(-8px) !important;\n    border-color: var(--gold) !important;\n}\n\n.region-image {\n    width: 100%;\n    height: 200px;\n    object-fit: cover;\n}\n\n.region-content {\n    padding: var(--space-5);\n}\n\n.region-name {\n    font-size: 1.5rem;\n    font-weight: 700;\n    margin-bottom: var(--space-2);\n    color: var(--gold) !important;\n}\n\n.region-description {\n    color: rgba(255, 255, 255, 0.8);\n    margin-bottom: var(--space-3);\n}\n\n.region-stats {\n    display: flex;\n    gap: var(--space-4);\n    font-size: 0.9rem;\n    color: rgba(255, 255, 255, 0.6);\n}\n\n/* ========================================\n   PACKAGES\n   ======================================== */\n.packages-section {\n    margin: var(--space-8) 0;\n}\n\n.packages-title {\n    font-size: 2rem;\n    font-weight: 800;\n    text-align: center;\n    margin-bottom: var(--space-6);\n    background: linear-gradient(135deg, var(--gold) 0%, var(--red) 100%) !important;\n    -webkit-background-clip: text !important;\n    -webkit-text-fill-color: transparent !important;\n    background-clip: text !important;\n}\n\n.packages-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: var(--space-5);\n}\n\n.package-card {\n    background: rgba(26, 14, 46, 0.6);\n    border: 1px solid rgba(201, 169, 97, 0.2);\n    border-radius: var(--radius-xl);\n    padding: var(--space-6);\n    cursor: pointer;\n    transition: transform 0.3s ease;\n}\n\n.package-card:hover {\n    transform: translateY(-4px);\n    border-color: var(--gold);\n}\n\n/* ========================================\n   BOTTOM NAVIGATION - Упрощенная\n   ======================================== */\n.bottom-nav {\n    position: fixed;\n    bottom: var(--space-5);\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 1000;\n\n    display: flex;\n    gap: var(--space-2);\n    padding: var(--space-3);\n\n    background: rgba(10, 1, 24, 0.95);\n    backdrop-filter: blur(20px);\n    border: 1px solid rgba(201, 169, 97, 0.2);\n    border-radius: var(--radius-2xl);\n}\n\n.nav-item {\n    position: relative;\n    min-width: 50px;\n    height: 50px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    border-radius: var(--radius-lg);\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    color: rgba(255, 255, 255, 0.6);\n    transition: all 0.3s ease;\n}\n\n.nav-item:hover,\n.nav-item.active {\n    color: var(--gold) !important;\n}\n\n.nav-icon {\n    font-size: 1.5rem;\n}\n\n.nav-label {\n    font-size: 0.7rem;\n    margin-top: 2px;\n}\n\n.quests-badge,\n.cart-badge {\n    position: absolute;\n    top: 2px;\n    right: 2px;\n    min-width: 18px;\n    height: 18px;\n    padding: 0 4px;\n    background: var(--red) !important;\n    color: white !important;\n    border-radius: 10px;\n    font-size: 0.7rem;\n    font-weight: 700;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n/* ========================================\n   TEAM SECTION\n   ======================================== */\n.team-section {\n    margin: var(--space-8) 0;\n}\n\n.team-title {\n    font-size: 2rem;\n    font-weight: 700;\n    text-align: center;\n    margin-bottom: var(--space-6);\n    color: var(--gold);\n}\n\n.team-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: var(--space-5);\n}\n\n.team-member {\n    text-align: center;\n}\n\n.member-photo-wrapper {\n    position: relative;\n    margin-bottom: var(--space-3);\n}\n\n.member-photo {\n    width: 100%;\n    max-width: 200px;\n    height: 200px;\n    border-radius: var(--radius-lg);\n    object-fit: cover;\n    border: 2px solid var(--gold);\n}\n\n.member-badge {\n    position: absolute;\n    top: 10px;\n    left: 50%;\n    transform: translateX(-50%);\n    background: var(--gold);\n    color: var(--dark);\n    padding: 4px 12px;\n    border-radius: 20px;\n    font-size: 0.8rem;\n    font-weight: 700;\n}\n\n.member-name {\n    font-size: 1.2rem;\n    font-weight: 700;\n    margin-bottom: var(--space-2);\n}\n\n.member-role {\n    color: rgba(255, 255, 255, 0.7);\n}\n\n/* ========================================\n   REGION DETAILS\n   ======================================== */\n.region-details {\n    display: none;\n}\n\n.region-details-header {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: var(--space-5);\n}\n\n.back-btn {\n    background: rgba(201, 169, 97, 0.2);\n    border: 1px solid var(--gold);\n    color: var(--white);\n    padding: var(--space-3) var(--space-5);\n    border-radius: var(--radius-md);\n    cursor: pointer;\n    font-size: 1rem;\n}\n\n.user-profile-btn {\n    background: transparent;\n    border: 1px solid var(--gold);\n    color: var(--white);\n    padding: var(--space-3) var(--space-5);\n    border-radius: var(--radius-md);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: var(--space-2);\n}\n\n/* ========================================\n   FOOTER\n   ======================================== */\n.footer {\n    text-align: center;\n    padding: var(--space-8) 0;\n    margin-top: var(--space-8);\n    color: rgba(255, 255, 255, 0.6);\n    border-top: 1px solid rgba(201, 169, 97, 0.2);\n}\n\n/* ========================================\n   LOADER\n   ======================================== */\n.loader {\n    position: fixed;\n    inset: 0;\n    background: rgba(10, 1, 24, 0.9);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    z-index: 9999;\n    opacity: 0;\n    visibility: hidden;\n    transition: opacity 0.3s ease, visibility 0.3s ease;\n}\n\n.loader.active {\n    opacity: 1;\n    visibility: visible;\n}\n\n.loader-spinner {\n    width: 60px;\n    height: 60px;\n    border: 4px solid rgba(201, 169, 97, 0.2);\n    border-top-color: var(--gold);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n\n.loader-text {\n    margin-top: var(--space-4);\n    color: var(--white);\n}\n\n/* ========================================\n   RESPONSIVE\n   ======================================== */\n@media (max-width: 768px) {\n    .hero-section {\n        min-height: 500px;\n    }\n\n    .hero-title {\n        font-size: 2rem;\n    }\n\n    .date-inputs-row {\n        flex-direction: column;\n        gap: var(--space-3);\n    }\n\n    .date-separator {\n        display: none;\n    }\n\n    .regions-grid {\n        grid-template-columns: 1fr;\n    }\n\n    .bottom-nav {\n        bottom: var(--space-3);\n        padding: var(--space-2);\n    }\n\n    .nav-item {\n        min-width: 44px;\n        height: 44px;\n    }\n\n    .nav-label {\n        display: none;\n    }\n}\n\n/* ========================================\n   UTILITIES\n   ======================================== */\n.hidden {\n    display: none !important;\n}\n\nbutton {\n    font-family: inherit;\n}\n\nimg {\n    max-width: 100%;\n    height: auto;\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/styles/matreshka-optimized.css b/styles/matreshka-optimized.css
--- a/styles/matreshka-optimized.css	(revision 8f6d951bebaad31c3e38bcab0f58b81da2f711d9)
+++ b/styles/matreshka-optimized.css	(date 1764921319290)
@@ -229,56 +229,127 @@
 }
 
 /* ========================================
-   REGION CARDS - Упрощенные
+   REGION CARDS - Aceternity Card Stack Style
    ======================================== */
 .regions-grid {
     display: grid;
-    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
-    gap: var(--space-5);
+    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
+    gap: 1.5rem;
     margin-top: var(--space-6);
+    padding: 0 0.5rem;
+}
+
+/* Контейнер для новых Aceternity карточек регионов */
+.region-card-container {
+    width: 100%;
+    min-height: 280px;
 }
 
 .region-card {
-    background: rgba(26, 14, 46, 0.6);
-    border: 1px solid rgba(201, 169, 97, 0.2);
-    border-radius: var(--radius-xl);
+    position: relative;
+    display: flex;
+    flex-direction: column;
+    justify-content: space-between;
+
+    /* Aceternity Glassmorphism */
+    background: rgba(255, 255, 255, 0.85);
+    backdrop-filter: blur(16px);
+    -webkit-backdrop-filter: blur(16px);
+
+    /* Скругления как в Apple Cards */
+    border-radius: 2rem;
+    border: 1px solid rgba(255, 255, 255, 0.6);
+
+    /* Мягкие тени "под айфон" */
+    box-shadow:
+        0 10px 40px rgba(0, 0, 0, 0.08),
+        0 4px 12px rgba(0, 0, 0, 0.05),
+        0 0 0 1px rgba(255, 255, 255, 0.5) inset;
+
     overflow: hidden;
     cursor: pointer;
-    transition: transform 0.3s ease, border-color 0.3s ease;
+    min-height: 380px;
+
+    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
+}
+
+/* Фиолетово-розовый градиент как в карусели */
+.region-card::before {
+    content: '';
+    position: absolute;
+    inset: 0;
+    background: linear-gradient(
+        135deg,
+        rgba(139, 92, 246, 0.12) 0%,
+        rgba(167, 139, 250, 0.08) 25%,
+        rgba(217, 70, 239, 0.06) 50%,
+        rgba(14, 165, 233, 0.08) 100%
+    );
+    opacity: 0.6;
+    pointer-events: none;
+    z-index: 0;
 }
 
 .region-card:hover {
-    transform: translateY(-8px) !important;
-    border-color: var(--gold) !important;
+    transform: translateY(-8px) scale(1.02);
+    box-shadow:
+        0 20px 60px rgba(139, 92, 246, 0.15),
+        0 10px 30px rgba(0, 0, 0, 0.1),
+        0 0 0 1px rgba(167, 139, 250, 0.3) inset;
+}
+
+.region-card:hover::before {
+    opacity: 0.85;
 }
 
 .region-image {
+    position: relative;
+    z-index: 1;
     width: 100%;
     height: 200px;
     object-fit: cover;
+    border-radius: 1.5rem 1.5rem 0 0;
 }
 
 .region-content {
-    padding: var(--space-5);
+    position: relative;
+    z-index: 1;
+    padding: 1.5rem;
+    flex: 1;
+    display: flex;
+    flex-direction: column;
+    gap: 0.75rem;
 }
 
 .region-name {
-    font-size: 1.5rem;
+    font-size: 1.4rem;
     font-weight: 700;
-    margin-bottom: var(--space-2);
-    color: var(--gold) !important;
+    margin-bottom: 0.25rem;
+
+    /* Фиолетовый акцент вместо золотого */
+    background: linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%);
+    -webkit-background-clip: text;
+    -webkit-text-fill-color: transparent;
+    background-clip: text;
+
+    line-height: 1.3;
 }
 
 .region-description {
-    color: rgba(255, 255, 255, 0.8);
-    margin-bottom: var(--space-3);
+    color: rgba(30, 41, 59, 0.8);
+    font-size: 0.95rem;
+    line-height: 1.6;
+    margin-bottom: 0.5rem;
 }
 
 .region-stats {
     display: flex;
-    gap: var(--space-4);
-    font-size: 0.9rem;
-    color: rgba(255, 255, 255, 0.6);
+    gap: 1rem;
+    font-size: 0.85rem;
+    color: rgba(30, 41, 59, 0.6);
+    margin-top: auto;
+    padding-top: 0.75rem;
+    border-top: 1px solid rgba(139, 92, 246, 0.1);
 }
 
 /* ========================================
@@ -309,9 +380,12 @@
     background: rgba(26, 14, 46, 0.6);
     border: 1px solid rgba(201, 169, 97, 0.2);
     border-radius: var(--radius-xl);
-    padding: var(--space-6);
+    padding: 0;
     cursor: pointer;
     transition: transform 0.3s ease;
+    overflow: hidden;
+    display: flex;
+    flex-direction: column;
 }
 
 .package-card:hover {
@@ -319,6 +393,98 @@
     border-color: var(--gold);
 }
 
+.package-image {
+    width: 100%;
+    height: 200px;
+    background-size: cover;
+    background-position: center;
+    background-repeat: no-repeat;
+}
+
+.package-content {
+    padding: var(--space-6);
+    display: flex;
+    flex-direction: column;
+    gap: var(--space-3);
+    flex: 1;
+}
+
+.package-name {
+    font-size: 1.5rem;
+    font-weight: 700;
+    color: var(--gold);
+    margin: 0;
+}
+
+.package-duration {
+    font-size: 0.9rem;
+    color: rgba(255, 255, 255, 0.6);
+}
+
+.package-cities {
+    display: flex;
+    flex-wrap: wrap;
+    gap: 0.5rem;
+}
+
+.city-tag {
+    background: rgba(201, 169, 97, 0.2);
+    border: 1px solid rgba(201, 169, 97, 0.3);
+    padding: 0.25rem 0.75rem;
+    border-radius: 1rem;
+    font-size: 0.85rem;
+    color: rgba(255, 255, 255, 0.8);
+}
+
+.package-description {
+    font-size: 0.95rem;
+    color: rgba(255, 255, 255, 0.7);
+    line-height: 1.5;
+    margin: 0;
+}
+
+.package-footer {
+    display: flex;
+    justify-content: space-between;
+    align-items: center;
+    margin-top: auto;
+    padding-top: var(--space-4);
+}
+
+.package-price {
+    display: flex;
+    flex-direction: column;
+    gap: 0.25rem;
+}
+
+.old-price {
+    font-size: 0.9rem;
+    color: rgba(255, 255, 255, 0.4);
+    text-decoration: line-through;
+}
+
+.current-price {
+    font-size: 1.5rem;
+    font-weight: 700;
+    color: var(--gold);
+}
+
+.package-btn {
+    background: linear-gradient(135deg, var(--gold) 0%, #b8860b 100%);
+    color: #0f0520;
+    border: none;
+    padding: 0.75rem 1.5rem;
+    border-radius: var(--radius-lg);
+    font-weight: 600;
+    cursor: pointer;
+    transition: all 0.3s ease;
+}
+
+.package-btn:hover {
+    transform: scale(1.05);
+    box-shadow: 0 4px 20px rgba(201, 169, 97, 0.4);
+}
+
 /* ========================================
    BOTTOM NAVIGATION - Упрощенная
    ======================================== */
@@ -394,6 +560,37 @@
     margin: var(--space-8) 0;
 }
 
+.team-header-aceternity {
+    text-align: center;
+    margin-bottom: 4rem;
+}
+
+.team-title-aceternity {
+    font-size: 2.5rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin-bottom: 1rem;
+}
+
+.team-subtitle-aceternity {
+    font-size: 1.125rem;
+    color: rgb(163, 163, 163);
+    max-width: 42rem;
+    margin: 0 auto;
+    line-height: 1.75;
+}
+
+@media (max-width: 768px) {
+    .team-title-aceternity {
+        font-size: 1.875rem;
+    }
+
+    .team-subtitle-aceternity {
+        font-size: 1rem;
+    }
+}
+
+/* Old styles - keep for backwards compatibility */
 .team-title {
     font-size: 2rem;
     font-weight: 700;
@@ -402,6 +599,14 @@
     color: var(--gold);
 }
 
+.team-tooltip-container {
+    display: flex;
+    justify-content: center;
+    align-items: center;
+    padding: var(--space-8) 0;
+    min-height: 200px;
+}
+
 .team-grid {
     display: grid;
     grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
@@ -484,6 +689,280 @@
     gap: var(--space-2);
 }
 
+/* Region Detail Page */
+.region-title {
+    font-size: 2.8rem;
+    font-weight: 900;
+    background: linear-gradient(135deg, var(--gold) 0%, #ff8e53 100%);
+    -webkit-background-clip: text;
+    -webkit-text-fill-color: transparent;
+    background-clip: text;
+    margin-bottom: 12px;
+    text-shadow: 0 4px 12px rgba(201, 169, 97, 0.3);
+    filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
+}
+
+.region-subtitle {
+    font-size: 1.3rem;
+    color: #e8e8e8;
+    font-weight: 400;
+    padding: 15px 25px;
+    background: rgba(201, 169, 97, 0.08);
+    border-radius: 12px;
+    display: inline-block;
+    margin-bottom: 20px;
+}
+
+.region-image-container {
+    margin: 40px 0;
+    border-radius: 20px;
+    overflow: hidden;
+    box-shadow: 0 16px 40px rgba(0,0,0,0.25);
+    border: 1px solid rgba(255,255,255,0.08);
+}
+
+.region-image-container .region-image {
+    height: 350px;
+    width: 100%;
+    object-fit: cover;
+}
+
+.region-image:hover {
+    filter: saturate(1.3) brightness(1.1);
+    transform: scale(1.02);
+}
+
+/* Section */
+.section {
+    margin: 50px 0;
+    background: rgba(255,255,255,0.04);
+    border-radius: 20px;
+    padding: 35px;
+    border: 1px solid rgba(255,255,255,0.08);
+    transition: all 0.3s ease;
+    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
+    position: relative;
+}
+
+.region-about,
+.section-content p {
+    font-size: 1.1rem;
+    color: #f5f5f5;
+    line-height: 1.9;
+    text-align: left;
+    padding: 20px;
+    background: rgba(201, 169, 97, 0.03);
+    border-left: 4px solid rgba(201, 169, 97, 0.4);
+    border-radius: 8px;
+    margin: 0;
+}
+
+.section::before {
+    content: '';
+    position: absolute;
+    top: 0;
+    left: 0;
+    right: 0;
+    height: 1px;
+    background: linear-gradient(90deg, transparent, rgba(201, 169, 97, 0.3), transparent);
+    border-radius: 20px 20px 0 0;
+}
+
+.section:hover {
+    background: rgba(255,255,255,0.06);
+    transform: translateY(-2px);
+    box-shadow: 0 16px 40px rgba(0,0,0,0.16), 0 0 40px rgba(201, 169, 97, 0.08);
+    border-color: rgba(201, 169, 97, 0.2);
+}
+
+.section-title {
+    font-size: 2rem;
+    font-weight: 800;
+    margin-bottom: 28px;
+    color: var(--gold) !important;
+    display: flex;
+    align-items: center;
+    gap: 15px;
+    position: relative;
+    text-shadow: 0 2px 8px rgba(201, 169, 97, 0.3);
+    letter-spacing: -0.01em;
+}
+
+.section-title span {
+    font-size: 1.5rem;
+    color: var(--gold);
+}
+
+.section-title,
+.section-title * {
+    color: var(--gold) !important;
+}
+
+.section-title::before {
+    content: '';
+    display: block;
+    width: 6px;
+    height: 30px;
+    background: linear-gradient(180deg, var(--gold), #ff8e53);
+    border-radius: 3px;
+    position: absolute;
+    left: -20px;
+    top: 0;
+}
+
+/* Attractions List */
+.attractions-list {
+    list-style: none;
+    padding: 0;
+    margin: 0;
+}
+
+.attractions-list li {
+    background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
+    margin: 20px 0;
+    padding: 24px;
+    border-radius: 20px;
+    transition: all 0.3s ease;
+    border: 1px solid rgba(255,255,255,0.08);
+    position: relative;
+    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
+}
+
+.attractions-list li::before {
+    content: '';
+    position: absolute;
+    left: 0;
+    top: 0;
+    bottom: 0;
+    width: 3px;
+    background: linear-gradient(180deg, var(--gold), #ff8e53);
+    border-radius: 0 14px 14px 0;
+    opacity: 0;
+    transition: opacity 0.3s ease;
+}
+
+.attractions-list li:hover::before {
+    opacity: 1;
+}
+
+.attractions-list li:hover {
+    transform: translateY(-4px);
+    background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
+    border-color: rgba(201, 169, 97, 0.2);
+    box-shadow: 0 16px 48px rgba(0,0,0,0.15), 0 0 30px rgba(201, 169, 97, 0.1);
+}
+
+.attraction-name {
+    font-size: 1.2rem;
+    font-weight: 700;
+    color: var(--gold);
+    margin-bottom: 12px;
+}
+
+.attraction-info {
+    font-size: 1rem;
+    color: rgba(255, 255, 255, 0.85);
+    line-height: 1.7;
+}
+
+/* Partners Grid */
+.partners-grid {
+    display: grid;
+    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
+    gap: 28px;
+}
+
+.partner-card {
+    background: rgba(255,255,255,0.06);
+    border-radius: 16px;
+    padding: 25px;
+    transition: all 0.3s ease;
+    cursor: pointer;
+    border: 1px solid rgba(255,255,255,0.06);
+    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
+    position: relative;
+    display: flex;
+    flex-direction: column;
+    gap: 15px;
+}
+
+.partner-card:hover {
+    transform: translateY(-4px);
+    background: rgba(255,255,255,0.08);
+    border-color: rgba(201, 169, 97, 0.2);
+    box-shadow: 0 12px 32px rgba(0,0,0,0.15), 0 0 20px rgba(201, 169, 97, 0.1);
+}
+
+.partner-name {
+    font-size: 1.2rem;
+    font-weight: 700;
+    color: var(--gold);
+}
+
+.partner-category {
+    font-size: 0.9rem;
+    color: rgba(255, 255, 255, 0.6);
+}
+
+.partner-description {
+    font-size: 1rem;
+    color: rgba(255, 255, 255, 0.85);
+    line-height: 1.6;
+}
+
+/* Map Container */
+.map-container {
+    width: 100%;
+    height: 450px;
+    border-radius: 16px;
+    overflow: hidden;
+    background: rgba(255,255,255,0.04);
+    border: 1px solid rgba(255,255,255,0.08);
+}
+
+.map-placeholder {
+    width: 100%;
+    height: 100%;
+    display: flex;
+    align-items: center;
+    justify-content: center;
+    background: linear-gradient(135deg, rgba(201, 169, 97, 0.05), rgba(255, 255, 255, 0.02));
+}
+
+.map-text {
+    font-size: 1.1rem;
+    color: rgba(255, 255, 255, 0.5);
+    font-style: italic;
+}
+
+/* Breadcrumbs */
+.breadcrumbs {
+    display: flex;
+    align-items: center;
+    gap: 8px;
+    margin-bottom: 24px;
+    font-size: 0.95rem;
+}
+
+.breadcrumb-item {
+    color: rgba(255, 255, 255, 0.6);
+    text-decoration: none;
+    transition: color 0.2s;
+}
+
+.breadcrumb-item:hover {
+    color: var(--gold);
+}
+
+.breadcrumb-item.active {
+    color: var(--white);
+    font-weight: 600;
+}
+
+.breadcrumb-separator {
+    color: rgba(255, 255, 255, 0.3);
+}
+
 /* ========================================
    FOOTER
    ======================================== */
@@ -557,7 +1036,20 @@
     }
 
     .regions-grid {
-        grid-template-columns: 1fr;
+        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
+        gap: 1rem;
+    }
+
+    .region-card {
+        min-height: 340px;
+    }
+
+    .region-name {
+        font-size: 1.2rem;
+    }
+
+    .region-description {
+        font-size: 0.9rem;
     }
 
     .bottom-nav {
@@ -573,6 +1065,36 @@
     .nav-label {
         display: none;
     }
+
+    /* Region Details - Mobile */
+    .region-title {
+        font-size: 2rem;
+    }
+
+    .section-title {
+        font-size: 1.6rem;
+    }
+
+    .section {
+        padding: 25px;
+        margin: 35px 0;
+    }
+
+    .region-image-container .region-image {
+        height: 220px;
+    }
+
+    .map-container {
+        height: 400px;
+    }
+
+    .partners-grid {
+        grid-template-columns: 1fr;
+    }
+
+    .user-profile-btn .profile-text {
+        display: none;
+    }
 }
 
 /* ========================================
@@ -590,3 +1112,1159 @@
     max-width: 100%;
     height: auto;
 }
+
+/* ========================================
+   PACKAGE MODAL - В стиле карточек регионов
+   ======================================== */
+.package-modal {
+    position: fixed;
+    top: 0;
+    left: 0;
+    width: 100%;
+    height: 100%;
+    background: rgba(0, 0, 0, 0.9);
+    backdrop-filter: blur(10px);
+    z-index: 10000;
+    display: flex;
+    align-items: center;
+    justify-content: center;
+    opacity: 0;
+    transition: opacity 0.3s ease;
+    padding: 20px;
+    overflow-y: auto;
+}
+
+.package-modal.show {
+    opacity: 1;
+}
+
+.package-modal-content {
+    background: rgba(23, 23, 23, 0.95);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 1rem;
+    max-width: 900px;
+    width: 100%;
+    max-height: 90vh;
+    overflow-y: auto;
+    position: relative;
+}
+
+.package-modal-close {
+    position: absolute;
+    top: 20px;
+    right: 20px;
+    background: rgba(255, 255, 255, 0.1);
+    border: none;
+    color: white;
+    font-size: 28px;
+    width: 40px;
+    height: 40px;
+    border-radius: 50%;
+    cursor: pointer;
+    z-index: 10;
+    transition: all 0.3s ease;
+}
+
+.package-modal-close:hover {
+    background: rgba(255, 255, 255, 0.2);
+    transform: rotate(90deg);
+}
+
+.package-modal-header {
+    display: flex;
+    gap: 20px;
+    padding: 30px;
+    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
+}
+
+.package-modal-image {
+    width: 250px;
+    height: 180px;
+    border-radius: 12px;
+    background-size: cover;
+    background-position: center;
+    flex-shrink: 0;
+}
+
+.package-modal-info {
+    flex: 1;
+}
+
+.package-modal-title {
+    font-size: 2rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin-bottom: 10px;
+}
+
+.package-modal-duration {
+    font-size: 1.1rem;
+    color: rgb(163, 163, 163);
+    margin-bottom: 15px;
+}
+
+.package-modal-price {
+    display: flex;
+    align-items: center;
+    gap: 15px;
+}
+
+.modal-old-price {
+    font-size: 1.2rem;
+    color: rgba(255, 255, 255, 0.3);
+    text-decoration: line-through;
+}
+
+.modal-current-price {
+    font-size: 2rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+}
+
+.package-validity-info {
+    display: flex;
+    align-items: center;
+    gap: 8px;
+    margin-top: 12px;
+    padding: 10px 16px;
+    background: rgba(255, 255, 255, 0.05);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 12px;
+}
+
+.validity-icon {
+    font-size: 1.2rem;
+}
+
+.validity-text {
+    font-size: 0.95rem;
+    color: rgb(212, 212, 212);
+    font-weight: 600;
+}
+
+.package-modal-body {
+    padding: 30px;
+}
+
+.package-section {
+    margin-bottom: 30px;
+}
+
+.package-section-title {
+    font-size: 1.5rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin-bottom: 15px;
+}
+
+.package-section-text {
+    font-size: 1.1rem;
+    color: rgb(212, 212, 212);
+    line-height: 1.7;
+}
+
+.package-cities-list {
+    display: flex;
+    flex-wrap: wrap;
+    gap: 10px;
+}
+
+.package-city-item {
+    padding: 8px 16px;
+    background: rgba(255, 255, 255, 0.05);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 16px;
+    font-size: 1rem;
+    color: rgb(212, 212, 212);
+}
+
+.package-partners-grid {
+    display: grid;
+    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
+    gap: 20px;
+    margin-top: 15px;
+}
+
+.package-partner-card {
+    background: rgba(255, 255, 255, 0.03);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 12px;
+    padding: 20px;
+    transition: all 0.3s ease;
+}
+
+.package-partner-card:hover {
+    background: rgba(255, 255, 255, 0.05);
+    border-color: rgba(255, 255, 255, 0.15);
+    transform: translateY(-2px);
+}
+
+.package-partner-header {
+    display: flex;
+    align-items: center;
+    gap: 12px;
+    margin-bottom: 12px;
+}
+
+.package-partner-emoji {
+    font-size: 2rem;
+    flex-shrink: 0;
+}
+
+.package-partner-info {
+    flex: 1;
+}
+
+.package-partner-name {
+    font-size: 1.1rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin-bottom: 4px;
+}
+
+.package-partner-city {
+    font-size: 0.85rem;
+    color: rgb(163, 163, 163);
+}
+
+.package-partner-rating {
+    font-size: 0.9rem;
+    color: rgb(212, 212, 212);
+    font-weight: 600;
+}
+
+.package-partner-type {
+    font-size: 0.9rem;
+    color: rgb(163, 163, 163);
+    margin-bottom: 10px;
+}
+
+.package-partner-description {
+    font-size: 0.95rem;
+    color: rgb(212, 212, 212);
+    line-height: 1.5;
+    margin-bottom: 12px;
+}
+
+.package-partner-offer {
+    background: rgba(255, 255, 255, 0.05);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 10px;
+    padding: 10px 12px;
+    font-size: 0.9rem;
+    color: rgb(212, 212, 212);
+    display: flex;
+    align-items: center;
+    gap: 8px;
+}
+
+.offer-icon {
+    font-size: 1.1rem;
+}
+
+.package-quests-section {
+    background: rgba(255, 255, 255, 0.02);
+    border-radius: 16px;
+    padding: 30px;
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    margin-top: 30px;
+}
+
+.package-quests-grid {
+    display: grid;
+    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
+    gap: 20px;
+    margin-bottom: 24px;
+}
+
+.package-quest-card {
+    background: rgba(255, 255, 255, 0.03);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 12px;
+    padding: 20px;
+    display: flex;
+    align-items: center;
+    gap: 16px;
+    transition: all 0.3s ease;
+}
+
+.package-quest-card:hover {
+    background: rgba(255, 255, 255, 0.05);
+    border-color: rgba(255, 255, 255, 0.15);
+    transform: translateY(-2px);
+}
+
+.quest-icon {
+    font-size: 2.5rem;
+    flex-shrink: 0;
+}
+
+.quest-info {
+    flex: 1;
+}
+
+.quest-title {
+    font-size: 0.95rem;
+    font-weight: 600;
+    color: rgb(250, 250, 250);
+    margin-bottom: 6px;
+    line-height: 1.3;
+}
+
+.quest-reward {
+    font-size: 0.9rem;
+    color: rgb(212, 212, 212);
+    font-weight: 700;
+}
+
+.quest-status {
+    flex-shrink: 0;
+}
+
+.quest-progress {
+    background: rgba(255, 255, 255, 0.1);
+    color: rgb(212, 212, 212);
+    padding: 6px 12px;
+    border-radius: 12px;
+    font-size: 0.85rem;
+    font-weight: 700;
+}
+
+.quest-action-btn {
+    background: rgba(255, 255, 255, 0.1);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 12px;
+    padding: 10px 20px;
+    color: rgb(250, 250, 250);
+    font-size: 0.85rem;
+    font-weight: 600;
+    cursor: pointer;
+    transition: all 0.3s ease;
+    flex-shrink: 0;
+}
+
+.quest-action-btn:hover {
+    background: rgba(255, 255, 255, 0.15);
+    transform: scale(1.05);
+}
+
+.total-discount {
+    background: rgba(255, 255, 255, 0.1);
+    color: rgb(250, 250, 250);
+    padding: 16px 24px;
+    border-radius: 12px;
+    font-size: 1.1rem;
+    font-weight: 700;
+    text-align: center;
+    border: 1px solid rgba(255, 255, 255, 0.1);
+}
+
+.package-modal-footer {
+    padding: 30px;
+    border-top: 1px solid rgba(255, 255, 255, 0.1);
+    display: flex;
+    flex-direction: column;
+    align-items: center;
+    gap: 12px;
+}
+
+.package-book-btn {
+    padding: 16px 40px;
+    background: rgba(255, 255, 255, 0.1);
+    border: 1px solid rgba(255, 255, 255, 0.2);
+    border-radius: 12px;
+    color: rgb(250, 250, 250);
+    font-size: 1.1rem;
+    font-weight: 700;
+    cursor: pointer;
+    transition: all 0.3s ease;
+}
+
+.package-book-btn:hover {
+    background: rgba(255, 255, 255, 0.15);
+    transform: scale(1.05);
+}
+
+.package-footer-note {
+    text-align: center;
+    color: rgb(163, 163, 163);
+    font-size: 0.9rem;
+}
+
+.package-notification {
+    position: fixed;
+    bottom: 30px;
+    left: 50%;
+    transform: translateX(-50%) translateY(100px);
+    background: rgba(23, 23, 23, 0.95);
+    border: 1px solid rgba(255, 255, 255, 0.2);
+    color: rgb(250, 250, 250);
+    padding: 16px 32px;
+    border-radius: 12px;
+    font-weight: 600;
+    font-size: 1rem;
+    z-index: 11000;
+    backdrop-filter: blur(10px);
+    transition: transform 0.3s ease;
+}
+
+.package-notification.show {
+    transform: translateX(-50%) translateY(0);
+}
+
+/* Мобильная адаптация */
+@media (max-width: 768px) {
+    .package-modal-content {
+        max-height: calc(100vh - 10px);
+        margin: 5px;
+    }
+
+    .package-modal-header {
+        flex-direction: column;
+        padding: 15px;
+    }
+
+    .package-modal-image {
+        width: 100%;
+        height: 140px;
+    }
+
+    .package-modal-title {
+        font-size: 1.3rem;
+    }
+
+    .modal-current-price {
+        font-size: 1.4rem;
+    }
+
+    .package-modal-body {
+        padding: 15px;
+    }
+
+    .package-partners-grid {
+        grid-template-columns: 1fr;
+        gap: 15px;
+    }
+
+    .package-quests-section {
+        padding: 20px 16px;
+    }
+
+    .package-quests-grid {
+        grid-template-columns: 1fr;
+        gap: 16px;
+    }
+
+    .package-quest-card {
+        padding: 16px;
+        flex-direction: column;
+        text-align: center;
+    }
+
+    .quest-action-btn {
+        width: 100%;
+    }
+
+    .package-modal-footer {
+        padding: 12px 15px;
+        position: fixed;
+        bottom: 0;
+        left: 0;
+        right: 0;
+        background: rgba(15, 5, 32, 0.98);
+        z-index: 10001;
+        box-shadow: 0 -4px 12px rgba(0,0,0,0.5);
+        backdrop-filter: blur(10px);
+    }
+
+    .package-book-btn {
+        width: 100%;
+        padding: 14px;
+        font-size: 1rem;
+    }
+}
+
+/* ========================================
+   NEW ACETERNITY-STYLE PACKAGES
+   ======================================== */
+.package-card-new {
+    position: relative;
+    overflow: hidden;
+    border-radius: 1rem;
+    border: 1px solid rgba(255, 255, 255, 0.05);
+    background: rgba(23, 23, 23, 0.9);
+    cursor: pointer;
+    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
+}
+
+.package-card-new.popular {
+    border-color: rgba(99, 102, 241, 0.5);
+    background: linear-gradient(to bottom, rgba(67, 56, 202, 0.1), rgba(23, 23, 23, 0.9));
+}
+
+.package-card-new:hover {
+    transform: translateY(-4px) scale(1.01);
+}
+
+.gradient-top-bar {
+    position: absolute;
+    top: 0;
+    left: 0;
+    right: 0;
+    height: 2px;
+    background: linear-gradient(to right, rgb(14, 165, 233), rgb(99, 102, 241), rgb(168, 85, 247));
+}
+
+.package-image-wrapper {
+    position: relative;
+    height: 12rem;
+    overflow: hidden;
+}
+
+.package-image-new {
+    width: 100%;
+    height: 100%;
+    object-fit: cover;
+    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
+}
+
+.package-card-new:hover .package-image-new {
+    transform: scale(1.1);
+}
+
+.image-gradient-overlay {
+    position: absolute;
+    inset: 0;
+    background: linear-gradient(to top, rgba(23, 23, 23, 1), rgba(23, 23, 23, 0.5), transparent);
+}
+
+.package-tag {
+    position: absolute;
+    top: 1rem;
+    right: 1rem;
+    padding: 0.375rem 0.75rem;
+    border-radius: 9999px;
+    background: rgba(255, 255, 255, 0.1);
+    backdrop-filter: blur(8px);
+    border: 1px solid rgba(255, 255, 255, 0.2);
+    color: rgb(229, 229, 229);
+    font-size: 0.875rem;
+    font-weight: 500;
+}
+
+.package-content-new {
+    padding: 1.5rem;
+    display: flex;
+    flex-direction: column;
+    gap: 1rem;
+}
+
+.package-header-new {
+    display: flex;
+    flex-direction: column;
+    gap: 0.5rem;
+}
+
+.package-name-new {
+    font-size: 1.5rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin: 0;
+}
+
+.package-duration-new {
+    font-size: 0.875rem;
+    color: rgb(163, 163, 163);
+    margin: 0;
+}
+
+.package-description-new {
+    color: rgb(212, 212, 212);
+    line-height: 1.625;
+    margin: 0;
+}
+
+.package-footer-new {
+    display: flex;
+    align-items: center;
+    justify-content: space-between;
+    padding-top: 1rem;
+    border-top: 1px solid rgba(255, 255, 255, 0.05);
+}
+
+.package-price-new {
+    display: flex;
+    flex-direction: column;
+    gap: 0.25rem;
+}
+
+.old-price-new {
+    font-size: 0.875rem;
+    color: rgba(255, 255, 255, 0.4);
+    text-decoration: line-through;
+}
+
+.current-price-new {
+    font-size: 1.5rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+}
+
+.package-btn-new {
+    padding: 0.625rem 1.25rem;
+    border-radius: 0.5rem;
+    background: rgba(255, 255, 255, 0.1);
+    color: rgb(250, 250, 250);
+    font-weight: 500;
+    border: none;
+    cursor: pointer;
+    transition: all 0.2s;
+}
+
+.package-btn-new:hover {
+    background: rgba(255, 255, 255, 0.2);
+    transform: scale(1.05);
+}
+
+.hover-glow {
+    position: absolute;
+    inset: 0;
+    opacity: 0;
+    background: linear-gradient(to top, rgba(99, 102, 241, 0.05), transparent);
+    transition: opacity 0.5s;
+    pointer-events: none;
+}
+
+.package-card-new:hover .hover-glow {
+    opacity: 1;
+}
+
+/* Мобильная адаптация */
+@media (max-width: 768px) {
+    .package-image-wrapper {
+        height: 10rem;
+    }
+
+    .package-name-new {
+        font-size: 1.25rem;
+    }
+
+    .current-price-new {
+        font-size: 1.25rem;
+    }
+
+    .package-footer-new {
+        flex-direction: column;
+        align-items: flex-start;
+        gap: 0.75rem;
+    }
+
+    .package-btn-new {
+        width: 100%;
+    }
+}
+
+/* ========================================
+   ACETERNITY-STYLE PACKAGES HEADER
+   ======================================== */
+.packages-header-aceternity {
+    text-align: center;
+    margin-bottom: 4rem;
+}
+
+.packages-title-aceternity {
+    font-size: 2.5rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin-bottom: 1rem;
+}
+
+.packages-subtitle-aceternity {
+    font-size: 1.125rem;
+    color: rgb(163, 163, 163);
+    max-width: 42rem;
+    margin: 0 auto;
+    line-height: 1.75;
+}
+
+@media (max-width: 768px) {
+    .packages-title-aceternity {
+        font-size: 1.875rem;
+    }
+
+    .packages-subtitle-aceternity {
+        font-size: 1rem;
+    }
+}
+
+/* ========================================
+   ACETERNITY-STYLE REGION CARDS
+   ======================================== */
+.region-card-wrapper-aceternity {
+    width: 100%;
+    position: relative;
+}
+
+.region-card-aceternity {
+    position: relative;
+    overflow: hidden;
+    border-radius: 1rem;
+    border: 1px solid rgba(255, 255, 255, 0.05);
+    background: rgba(23, 23, 23, 0.9);
+    cursor: pointer;
+    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
+}
+
+.region-card-aceternity.featured {
+    border-color: rgba(99, 102, 241, 0.5);
+    background: linear-gradient(to bottom, rgba(67, 56, 202, 0.1), rgba(23, 23, 23, 0.9));
+}
+
+.region-card-aceternity:hover {
+    transform: translateY(-4px) scale(1.01);
+}
+
+.region-image-wrapper {
+    position: relative;
+    height: 12rem;
+    overflow: hidden;
+}
+
+.region-image-aceternity {
+    width: 100%;
+    height: 100%;
+    object-fit: cover;
+    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
+}
+
+.region-card-aceternity:hover .region-image-aceternity {
+    transform: scale(1.1);
+}
+
+.region-tag {
+    position: absolute;
+    top: 1rem;
+    right: 1rem;
+    padding: 0.375rem 0.75rem;
+    border-radius: 9999px;
+    background: rgba(255, 255, 255, 0.1);
+    backdrop-filter: blur(8px);
+    border: 1px solid rgba(255, 255, 255, 0.2);
+    color: rgb(229, 229, 229);
+    font-size: 0.875rem;
+    font-weight: 500;
+    z-index: 10;
+}
+
+.region-content-aceternity {
+    padding: 1.5rem;
+    display: flex;
+    flex-direction: column;
+    gap: 1rem;
+}
+
+.region-header {
+    display: flex;
+    flex-direction: column;
+    gap: 0.5rem;
+}
+
+.region-name-aceternity {
+    font-size: 1.5rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin: 0;
+    line-height: 1.2;
+}
+
+.region-description-aceternity {
+    font-size: 0.875rem;
+    color: rgb(163, 163, 163);
+    margin: 0;
+    line-height: 1.5;
+}
+
+.region-card-aceternity .hover-glow {
+    position: absolute;
+    inset: -2px;
+    background: linear-gradient(to right, rgb(14, 165, 233), rgb(99, 102, 241));
+    border-radius: 1rem;
+    opacity: 0;
+    transition: opacity 0.3s ease;
+    z-index: -1;
+    filter: blur(20px);
+}
+
+.region-card-aceternity:hover .hover-glow {
+    opacity: 1;
+}
+
+/* Мобильная адаптация */
+@media (max-width: 768px) {
+    .region-image-wrapper {
+        height: 10rem;
+    }
+
+    .region-name-aceternity {
+        font-size: 1.25rem;
+    }
+
+    .region-content-aceternity {
+        padding: 1.25rem;
+    }
+}
+
+/* ========================================
+   ACETERNITY-STYLE REGION DETAILS PAGE
+   ======================================== */
+.region-details-aceternity {
+    display: none;
+    min-height: 100vh;
+    background: #0a0a0a;
+}
+
+/* Top Navigation Bar */
+.region-nav-bar {
+    position: sticky;
+    top: 0;
+    z-index: 100;
+    display: flex;
+    justify-content: space-between;
+    align-items: center;
+    padding: 1rem 1.5rem;
+    background: rgba(10, 10, 10, 0.95);
+    backdrop-filter: blur(10px);
+    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
+}
+
+.back-btn-aceternity {
+    display: flex;
+    align-items: center;
+    gap: 0.5rem;
+    padding: 0.625rem 1.25rem;
+    background: rgba(255, 255, 255, 0.05);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 0.5rem;
+    color: rgb(250, 250, 250);
+    font-size: 0.9375rem;
+    font-weight: 500;
+    cursor: pointer;
+    transition: all 0.2s ease;
+}
+
+.back-btn-aceternity:hover {
+    background: rgba(255, 255, 255, 0.1);
+    border-color: rgba(255, 255, 255, 0.2);
+    transform: translateX(-2px);
+}
+
+.back-arrow {
+    font-size: 1.125rem;
+}
+
+.profile-btn-aceternity {
+    width: 2.5rem;
+    height: 2.5rem;
+    display: flex;
+    align-items: center;
+    justify-content: center;
+    background: rgba(255, 255, 255, 0.05);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 50%;
+    cursor: pointer;
+    transition: all 0.2s ease;
+}
+
+.profile-btn-aceternity:hover {
+    background: rgba(255, 255, 255, 0.1);
+    border-color: rgba(255, 255, 255, 0.2);
+}
+
+.profile-icon-aceternity {
+    font-size: 1.25rem;
+}
+
+/* Hero Section */
+.region-hero-aceternity {
+    position: relative;
+    height: 60vh;
+    min-height: 400px;
+    max-height: 600px;
+    overflow: hidden;
+}
+
+.region-hero-image-wrapper {
+    position: absolute;
+    inset: 0;
+}
+
+.region-hero-image {
+    width: 100%;
+    height: 100%;
+    object-fit: cover;
+}
+
+.region-hero-overlay {
+    position: absolute;
+    inset: 0;
+    background: linear-gradient(
+        to bottom,
+        rgba(10, 10, 10, 0.3) 0%,
+        rgba(10, 10, 10, 0.7) 70%,
+        rgba(10, 10, 10, 0.95) 100%
+    );
+}
+
+.region-hero-content {
+    position: absolute;
+    bottom: 0;
+    left: 0;
+    right: 0;
+    padding: 2rem 1.5rem;
+    z-index: 10;
+}
+
+.region-hero-title {
+    font-size: 2.5rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin: 0 0 0.75rem 0;
+    text-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
+}
+
+.region-hero-subtitle {
+    font-size: 1.125rem;
+    color: rgb(212, 212, 212);
+    margin: 0;
+    max-width: 600px;
+    text-shadow: 0 1px 10px rgba(0, 0, 0, 0.5);
+}
+
+/* Main Content */
+.region-content-aceternity {
+    padding: 2rem 1.5rem;
+    max-width: 1200px;
+    margin: 0 auto;
+}
+
+/* Section Styling */
+.region-section-aceternity {
+    margin-bottom: 4rem;
+}
+
+.section-header-aceternity {
+    text-align: center;
+    margin-bottom: 2.5rem;
+}
+
+.section-title-aceternity {
+    font-size: 2rem;
+    font-weight: 700;
+    color: rgb(250, 250, 250);
+    margin: 0 0 0.75rem 0;
+}
+
+.section-subtitle-aceternity {
+    font-size: 1rem;
+    color: rgb(163, 163, 163);
+    margin: 0;
+}
+
+/* Card Container */
+.section-card-aceternity {
+    background: rgba(23, 23, 23, 0.9);
+    border: 1px solid rgba(255, 255, 255, 0.05);
+    border-radius: 1rem;
+    padding: 2rem;
+}
+
+.region-about-aceternity {
+    font-size: 1rem;
+    line-height: 1.75;
+    color: rgb(212, 212, 212);
+    margin: 0;
+    white-space: pre-wrap;
+}
+
+/* Attractions Grid */
+.attractions-grid-aceternity {
+    display: grid;
+    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
+    gap: 1.5rem;
+}
+
+.attraction-card-aceternity {
+    background: rgba(23, 23, 23, 0.9);
+    border: 1px solid rgba(255, 255, 255, 0.05);
+    border-radius: 1rem;
+    padding: 1.5rem;
+    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
+    cursor: pointer;
+}
+
+.attraction-card-aceternity:hover {
+    transform: translateY(-4px);
+    border-color: rgba(255, 255, 255, 0.1);
+    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
+}
+
+.attraction-name-aceternity {
+    font-size: 1.25rem;
+    font-weight: 600;
+    color: rgb(250, 250, 250);
+    margin: 0 0 0.75rem 0;
+    display: block;
+}
+
+.attraction-info-aceternity {
+    font-size: 0.9375rem;
+    line-height: 1.6;
+    color: rgb(163, 163, 163);
+    margin: 0 0 1rem 0;
+}
+
+.attraction-route-btn {
+    display: inline-flex;
+    align-items: center;
+    gap: 0.5rem;
+    padding: 0.5rem 1rem;
+    background: rgba(255, 255, 255, 0.05);
+    border: 1px solid rgba(255, 255, 255, 0.1);
+    border-radius: 0.5rem;
+    color: rgb(250, 250, 250);
+    font-size: 0.875rem;
+    font-weight: 500;
+    cursor: pointer;
+    transition: all 0.2s ease;
+}
+
+.attraction-route-btn:hover {
+    background: rgba(255, 255, 255, 0.1);
+    border-color: rgba(255, 255, 255, 0.2);
+}
+
+/* Partners Grid */
+.partners-grid-aceternity {
+    display: grid;
+    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
+    gap: 1.5rem;
+}
+
+.partner-card-aceternity {
+    background: rgba(23, 23, 23, 0.9);
+    border: 1px solid rgba(255, 255, 255, 0.05);
+    border-radius: 1rem;
+    padding: 1.5rem;
+    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
+}
+
+.partner-card-aceternity:hover {
+    transform: translateY(-4px);
+    border-color: rgba(255, 255, 255, 0.1);
+    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
+}
+
+.partner-header-aceternity {
+    display: flex;
+    align-items: flex-start;
+    gap: 1rem;
+    margin-bottom: 1rem;
+}
+
+.partner-emoji {
+    font-size: 2rem;
+    flex-shrink: 0;
+}
+
+.partner-info {
+    flex: 1;
+}
+
+.partner-name-aceternity {
+    font-size: 1.125rem;
+    font-weight: 600;
+    color: rgb(250, 250, 250);
+    margin: 0 0 0.25rem 0;
+}
+
+.partner-type-aceternity {
+    font-size: 0.875rem;
+    color: rgb(163, 163, 163);
+    margin: 0;
+}
+
+.partner-description-aceternity {
+    font-size: 0.9375rem;
+    line-height: 1.6;
+    color: rgb(212, 212, 212);
+    margin: 0 0 1rem 0;
+}
+
+.partner-footer-aceternity {
+    display: flex;
+    justify-content: space-between;
+    align-items: center;
+    padding-top: 1rem;
+    border-top: 1px solid rgba(255, 255, 255, 0.05);
+}
+
+.partner-rating-aceternity {
+    display: flex;
+    align-items: center;
+    gap: 0.5rem;
+    font-size: 0.875rem;
+    color: rgb(212, 212, 212);
+}
+
+.partner-special-offer-aceternity {
+    font-size: 0.8125rem;
+    color: rgb(99, 102, 241);
+    font-weight: 500;
+    background: rgba(99, 102, 241, 0.1);
+    padding: 0.375rem 0.75rem;
+    border-radius: 0.5rem;
+}
+
+/* Map Container */
+.map-container-aceternity {
+    width: 100%;
+    height: 500px;
+    border-radius: 0.75rem;
+    overflow: hidden;
+    background: rgba(255, 255, 255, 0.02);
+}
+
+/* Mobile Responsive */
+@media (max-width: 768px) {
+    .region-hero-title {
+        font-size: 2rem;
+    }
+
+    .region-hero-subtitle {
+        font-size: 1rem;
+    }
+
+    .region-content-aceternity {
+        padding: 1.5rem 1rem;
+    }
+
+    .section-title-aceternity {
+        font-size: 1.5rem;
+    }
+
+    .section-card-aceternity {
+        padding: 1.5rem;
+    }
+
+    .attractions-grid-aceternity {
+        grid-template-columns: 1fr;
+    }
+
+    .partners-grid-aceternity {
+        grid-template-columns: 1fr;
+    }
+
+    .map-container-aceternity {
+        height: 400px;
+    }
+}
Index: scripts/modules/packages.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>/**\n * Модуль управления пакетами путешествий\n */\n\n// Загрузка и отображение пакетов\nlet loadPackagesAttempts = 0;\nconst MAX_LOAD_ATTEMPTS = 10;\n\nfunction loadTravelPackages() {\n    console.log('\uD83D\uDCE6 Загрузка пакетов путешествий...');\n    console.log('\uD83D\uDD0D window.TRAVEL_PACKAGES:', window.TRAVEL_PACKAGES);\n    console.log('\uD83D\uDD0D typeof TRAVEL_PACKAGES:', typeof TRAVEL_PACKAGES);\n\n    const packagesGrid = document.getElementById('packagesGrid');\n    if (!packagesGrid) {\n        console.error('❌ Контейнер packagesGrid не найден');\n        return;\n    }\n\n    if (typeof TRAVEL_PACKAGES === 'undefined') {\n        loadPackagesAttempts++;\n\n        if (loadPackagesAttempts >= MAX_LOAD_ATTEMPTS) {\n            console.error('❌ TRAVEL_PACKAGES не загружены после', MAX_LOAD_ATTEMPTS, 'попыток');\n            packagesGrid.innerHTML = `\n                <div class=\"packages-error\">\n                    <div class=\"error-icon\">⚠\uFE0F</div>\n                    <div class=\"error-text\">Не удалось загрузить пакеты путешествий</div>\n                    <button class=\"retry-btn\" onclick=\"loadPackagesAttempts = 0; loadTravelPackages()\">\n                        Попробовать снова\n                    </button>\n                </div>\n            `;\n            return;\n        }\n\n        console.warn(`⏳ TRAVEL_PACKAGES не загружены, попытка ${loadPackagesAttempts}/${MAX_LOAD_ATTEMPTS}...`);\n        setTimeout(loadTravelPackages, 100);\n        return;\n    }\n\n    if (!TRAVEL_PACKAGES || !Array.isArray(TRAVEL_PACKAGES)) {\n        console.error('❌ TRAVEL_PACKAGES не является массивом:', TRAVEL_PACKAGES);\n        packagesGrid.innerHTML = `\n            <div class=\"packages-error\">\n                <div class=\"error-icon\">❌</div>\n                <div class=\"error-text\">Ошибка формата данных пакетов</div>\n            </div>\n        `;\n        return;\n    }\n\n    console.log(`✅ Найдено ${TRAVEL_PACKAGES.length} пакетов`);\n    loadPackagesAttempts = 0; // Сбрасываем счетчик после успешной загрузки\n\n    packagesGrid.innerHTML = TRAVEL_PACKAGES.map(pkg => `\n        <div class=\"package-card aceternity-card spotlight-container ripple\" onclick=\"showPackageModal('${pkg.id}')\" data-package-id=\"${pkg.id}\">\n            <div class=\"spotlight\"></div>\n            <div class=\"package-image shimmer\" style=\"background-image: url('${pkg.image}')\"></div>\n            <div class=\"package-content\">\n                <h3 class=\"package-name\">${pkg.name}</h3>\n                <div class=\"package-duration\">${pkg.duration}</div>\n                <div class=\"package-cities\">\n                    ${pkg.cities.slice(0, 3).map(city => `<span class=\"city-tag\">${city}</span>`).join('')}\n                    ${pkg.cities.length > 3 ? `<span class=\"city-tag\">+${pkg.cities.length - 3}</span>` : ''}\n                </div>\n                <p class=\"package-description\">${pkg.description}</p>\n                <div class=\"package-footer\">\n                    <div class=\"package-price\">\n                        ${pkg.oldPrice ? `<span class=\"old-price\">${pkg.oldPrice.toLocaleString()} ₽</span>` : ''}\n                        <span class=\"current-price\">${pkg.price.toLocaleString()} ₽</span>\n                    </div>\n                    <button class=\"package-btn\">Подробнее</button>\n                </div>\n            </div>\n        </div>\n    `).join('');\n\n    // Инициализируем Aceternity эффекты для карточек пакетов\n    setTimeout(() => {\n        const packageCards = document.querySelectorAll('.package-card.aceternity-card');\n        packageCards.forEach(card => {\n            const spotlight = card.querySelector('.spotlight');\n\n            // 3D tilt эффект при движении мыши\n            card.addEventListener('mousemove', (e) => {\n                const rect = card.getBoundingClientRect();\n                const x = ((e.clientX - rect.left) / rect.width - 0.5) * 15;\n                const y = ((e.clientY - rect.top) / rect.height - 0.5) * -15;\n                card.style.setProperty('--mouse-x', `${x}deg`);\n                card.style.setProperty('--mouse-y', `${y}deg`);\n\n                // Перемещаем spotlight\n                if (spotlight) {\n                    spotlight.style.left = `${e.clientX - rect.left - 200}px`;\n                    spotlight.style.top = `${e.clientY - rect.top - 200}px`;\n                }\n            });\n\n            card.addEventListener('mouseleave', () => {\n                card.style.setProperty('--mouse-x', '0deg');\n                card.style.setProperty('--mouse-y', '0deg');\n            });\n        });\n        console.log('✨ Aceternity эффекты применены к', packageCards.length, 'карточкам пакетов');\n    }, 100);\n}\n\n// Получить партнеров из городов пакета\nfunction getPartnersForPackage(pkg) {\n    const allPartners = [];\n\n    // Проходим по всем городам пакета\n    pkg.cities.forEach(cityName => {\n        // Ищем регион с таким городом\n        Object.values(RUSSIA_REGIONS_DATA).forEach(region => {\n            if (region.name === cityName || region.city === cityName) {\n                if (region.partners && region.partners.length > 0) {\n                    region.partners.forEach(partner => {\n                        allPartners.push({\n                            ...partner,\n                            city: cityName\n                        });\n                    });\n                }\n            }\n        });\n    });\n\n    return allPartners;\n}\n\n// Показ модального окна с деталями пакета\nfunction showPackageModal(packageId) {\n    const pkg = TRAVEL_PACKAGES.find(p => p.id === packageId);\n    if (!pkg) return;\n\n    // Получаем партнеров из городов пакета\n    const partners = getPartnersForPackage(pkg);\n\n    const modal = document.createElement('div');\n    modal.className = 'package-modal';\n    modal.id = 'packageModal';\n\n    modal.innerHTML = `\n        <div class=\"package-modal-content\">\n            <button class=\"package-modal-close\" onclick=\"closePackageModal()\">✕</button>\n\n            <div class=\"package-modal-header\">\n                <div class=\"package-modal-image\" style=\"background-image: url('${pkg.image}')\"></div>\n                <div class=\"package-modal-info\">\n                    <h2 class=\"package-modal-title\">${pkg.name}</h2>\n                    <div class=\"package-modal-duration\">${pkg.duration}</div>\n                    <div class=\"package-modal-price\">\n                        ${pkg.oldPrice ? `<span class=\"modal-old-price\">${pkg.oldPrice.toLocaleString()} ₽</span>` : ''}\n                        <span class=\"modal-current-price\">${pkg.price.toLocaleString()} ₽</span>\n                    </div>\n                    <div class=\"package-validity-info\">\n                        <span class=\"validity-icon\">⏱\uFE0F</span>\n                        <span class=\"validity-text\">Срок действия: 7 дней после покупки</span>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"package-modal-body\">\n                <div class=\"package-section\">\n                    <h3 class=\"package-section-title\">Описание</h3>\n                    <p class=\"package-section-text\">${pkg.description}</p>\n                </div>\n\n                <div class=\"package-section\">\n                    <h3 class=\"package-section-title\">Города в маршруте</h3>\n                    <div class=\"package-cities-list\">\n                        ${pkg.cities.map(city => `<span class=\"package-city-item\">${city}</span>`).join('')}\n                    </div>\n                </div>\n\n                ${partners.length > 0 ? `\n                <div class=\"package-section\">\n                    <h3 class=\"package-section-title\">\uD83C\uDF7D\uFE0F Партнеры со скидками (${partners.length})</h3>\n                    <div class=\"package-partners-grid\">\n                        ${partners.map(partner => `\n                            <div class=\"package-partner-card\">\n                                <div class=\"package-partner-header\">\n                                    <span class=\"package-partner-emoji\">${partner.emoji || '\uD83C\uDFEA'}</span>\n                                    <div class=\"package-partner-info\">\n                                        <div class=\"package-partner-name\">${partner.name}</div>\n                                        <div class=\"package-partner-city\">${partner.city}</div>\n                                    </div>\n                                    ${partner.rating ? `<div class=\"package-partner-rating\">⭐ ${partner.rating}</div>` : ''}\n                                </div>\n                                <div class=\"package-partner-type\">${partner.type}</div>\n                                <div class=\"package-partner-description\">${partner.description}</div>\n                                ${partner.specialOffer ? `\n                                    <div class=\"package-partner-offer\">\n                                        <span class=\"offer-icon\">\uD83C\uDF81</span>\n                                        ${partner.specialOffer}\n                                    </div>\n                                ` : ''}\n                            </div>\n                        `).join('')}\n                    </div>\n                </div>\n                ` : ''}\n\n                <div class=\"package-section package-quests-section\">\n                    <h3 class=\"package-section-title\">\uD83C\uDFAF Выполните задания и получите скидку!</h3>\n                    <div class=\"package-quests-grid\">\n                        <div class=\"package-quest-card\" data-quest=\"favorites\">\n                            <div class=\"quest-icon\">❤\uFE0F</div>\n                            <div class=\"quest-info\">\n                                <div class=\"quest-title\">Добавьте 3 города в избранное</div>\n                                <div class=\"quest-reward\">Скидка 5%</div>\n                            </div>\n                            <div class=\"quest-status\" id=\"quest-favorites-${pkg.id}\">\n                                <span class=\"quest-progress\">0/3</span>\n                            </div>\n                        </div>\n\n                        <div class=\"package-quest-card\" data-quest=\"views\">\n                            <div class=\"quest-icon\">\uD83D\uDC40</div>\n                            <div class=\"quest-info\">\n                                <div class=\"quest-title\">Посмотрите 5 достопримечательностей</div>\n                                <div class=\"quest-reward\">Скидка 3%</div>\n                            </div>\n                            <div class=\"quest-status\" id=\"quest-views-${pkg.id}\">\n                                <span class=\"quest-progress\">0/5</span>\n                            </div>\n                        </div>\n\n                        <div class=\"package-quest-card\" data-quest=\"share\">\n                            <div class=\"quest-icon\">\uD83D\uDCE4</div>\n                            <div class=\"quest-info\">\n                                <div class=\"quest-title\">Поделитесь пакетом с друзьями</div>\n                                <div class=\"quest-reward\">Скидка 2%</div>\n                            </div>\n                            <button class=\"quest-action-btn\" onclick=\"sharePackage('${pkg.id}')\">\n                                Поделиться\n                            </button>\n                        </div>\n\n                        <div class=\"package-quest-card\" data-quest=\"review\">\n                            <div class=\"quest-icon\">⭐</div>\n                            <div class=\"quest-info\">\n                                <div class=\"quest-title\">Оставьте отзыв о сервисе</div>\n                                <div class=\"quest-reward\">Бонус 500 ₽</div>\n                            </div>\n                            <button class=\"quest-action-btn\" onclick=\"leaveReview('${pkg.id}')\">\n                                Написать отзыв\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"total-discount\">\n                        \uD83D\uDCB0 Ваша итоговая скидка: <span id=\"total-discount-${pkg.id}\">0%</span>\n                    </div>\n                </div>\n\n                <div class=\"package-modal-footer\">\n                    <button class=\"package-book-btn\" onclick=\"bookPackage('${pkg.id}')\">\n                        <span id=\"book-btn-text-${pkg.id}\">Купить пакет за ${pkg.price.toLocaleString()} ₽</span>\n                    </button>\n                    <div class=\"package-footer-note\">Действует 7 дней после покупки</div>\n                </div>\n            </div>\n        </div>\n    `;\n\n    document.body.appendChild(modal);\n    setTimeout(() => modal.classList.add('show'), 10);\n\n    // Закрытие по клику вне модалки\n    modal.addEventListener('click', (e) => {\n        if (e.target === modal) {\n            closePackageModal();\n        }\n    });\n}\n\n// Закрытие модального окна\nfunction closePackageModal() {\n    const modal = document.getElementById('packageModal');\n    if (modal) {\n        modal.classList.remove('show');\n        setTimeout(() => modal.remove(), 300);\n    }\n}\n\n// Переключение отображения деталей маршрута\nfunction toggleRoute(routeId, packageId) {\n    const routeDetails = document.getElementById(`route-${packageId}-${routeId}`);\n    const toggle = event.currentTarget.querySelector('.package-route-toggle');\n\n    if (routeDetails.style.display === 'none') {\n        routeDetails.style.display = 'block';\n        toggle.textContent = '▲';\n    } else {\n        routeDetails.style.display = 'none';\n        toggle.textContent = '▼';\n    }\n}\n\n// Бронирование пакета\nfunction bookPackage(packageId) {\n    const pkg = TRAVEL_PACKAGES.find(p => p.id === packageId);\n    if (!pkg) return;\n\n    // Сохраняем купленный пакет в localStorage\n    const purchasedPackages = JSON.parse(localStorage.getItem('purchasedPackages') || '[]');\n\n    // Проверяем, не куплен ли уже этот пакет\n    const existingPackage = purchasedPackages.find(p => p.id === packageId);\n    if (existingPackage) {\n        showNotification(`Пакет \"${pkg.name}\" уже активен до ${new Date(existingPackage.expiresAt).toLocaleDateString('ru-RU')}`);\n        return;\n    }\n\n    // Добавляем новый пакет со сроком действия 7 дней\n    const purchaseDate = new Date();\n    const expiresAt = new Date(purchaseDate);\n    expiresAt.setDate(expiresAt.getDate() + 7);\n\n    // Получаем всех партнеров из городов пакета\n    const partners = getPartnersForPackage(pkg);\n\n    const purchasedPackage = {\n        id: pkg.id,\n        name: pkg.name,\n        purchaseDate: purchaseDate.toISOString(),\n        expiresAt: expiresAt.toISOString(),\n        cities: pkg.cities,\n        price: pkg.price,\n        partners: partners  // \uD83D\uDD25 СОХРАНЯЕМ ПАРТНЕРОВ ВМЕСТЕ С ПАКЕТОМ!\n    };\n\n    purchasedPackages.push(purchasedPackage);\n    localStorage.setItem('purchasedPackages', JSON.stringify(purchasedPackages));\n\n    // \uD83C\uDF0D Автоматически увеличиваем счетчик путешествий в профиле\n    try {\n        const profileData = JSON.parse(sessionStorage.getItem('matryoshka_profile') || '{}');\n        profileData.travels = (profileData.travels || 0) + 1;\n        sessionStorage.setItem('matryoshka_profile', JSON.stringify(profileData));\n        console.log('\uD83C\uDF0D Счетчик путешествий увеличен:', profileData.travels);\n    } catch (e) {\n        console.error('Ошибка обновления счетчика путешествий:', e);\n    }\n\n    console.log('\uD83D\uDCBE Пакет сохранен в localStorage:', purchasedPackage);\n    console.log('\uD83D\uDCBE Всего пакетов в localStorage:', purchasedPackages.length);\n\n    // Показываем уведомление\n    showNotification(`✅ Пакет \"${pkg.name}\" успешно куплен! Действителен до ${expiresAt.toLocaleDateString('ru-RU')}`);\n    closePackageModal();\n\n    // \uD83D\uDD25 ОБНОВЛЯЕМ КОРЗИНУ И АВТОМАТИЧЕСКИ ОТКРЫВАЕМ ЕЕ\n    console.log('\uD83D\uDD0D window.matryoshkaCart существует?', !!window.matryoshkaCart);\n    console.log('\uD83D\uDD0D showCart функция существует?', typeof showCart);\n\n    if (window.matryoshkaCart) {\n        console.log('\uD83D\uDD04 Обновляю корзину...');\n        window.matryoshkaCart.refresh();\n        // Автоматически открываем корзину после покупки\n        if (typeof showCart === 'function') {\n            showCart();\n            console.log('✅ Корзина обновлена и открыта');\n        } else {\n            console.error('❌ showCart не является функцией!');\n        }\n    } else {\n        console.error('❌ window.matryoshkaCart не найден!');\n    }\n\n    // Обновляем профиль если он открыт\n    if (window.matryoshkaProfile && document.getElementById('profileSection').style.display !== 'none') {\n        window.matryoshkaProfile.loadProfileData();\n    }\n\n    // \uD83C\uDFAF ДОБАВЛЯЕМ РЕГИОНЫ ИЗ ПАКЕТА В ОПЛАЧЕННЫЕ И ГЕНЕРИРУЕМ ЗАДАНИЯ\n    console.log('\uD83C\uDFAF Добавляем регионы из пакета в оплаченные...');\n\n    // Инициализируем paidRegions если нужно\n    if (typeof window.paidRegions === 'undefined') {\n        window.paidRegions = [];\n        const saved = localStorage.getItem('paidRegions');\n        if (saved) {\n            try {\n                window.paidRegions = JSON.parse(saved);\n            } catch (e) {\n                window.paidRegions = [];\n            }\n        }\n    }\n\n    // Для каждого города в пакете находим соответствующий регион\n    let addedRegions = 0;\n    pkg.cities.forEach(cityName => {\n        // Ищем регион с таким названием\n        const regionEntry = Object.entries(window.RUSSIA_REGIONS_DATA || {}).find(([key, region]) => {\n            return region.name === cityName || region.city === cityName;\n        });\n\n        if (regionEntry) {\n            const [regionId, regionData] = regionEntry;\n\n            // Проверяем, не добавлен ли уже этот регион\n            const existingRegion = window.paidRegions.find(r => r.id === regionId);\n            if (!existingRegion) {\n                // Добавляем регион в оплаченные со сроком действия 7 дней\n                const purchaseDate = new Date();\n                const expiresAt = new Date(purchaseDate);\n                expiresAt.setDate(expiresAt.getDate() + 7);\n\n                const paidRegion = {\n                    id: regionId,\n                    purchaseDate: purchaseDate.toISOString(),\n                    expiresAt: expiresAt.toISOString()\n                };\n\n                window.paidRegions.push(paidRegion);\n                addedRegions++;\n                console.log(`✅ Регион ${regionData.name} (${regionId}) добавлен в оплаченные`);\n            } else {\n                console.log(`ℹ\uFE0F Регион ${regionData.name} (${regionId}) уже оплачен`);\n            }\n        } else {\n            console.warn(`⚠\uFE0F Не найден регион для города: ${cityName}`);\n        }\n    });\n\n    // Сохраняем обновленный список в sessionStorage\n    localStorage.setItem('paidRegions', JSON.stringify(window.paidRegions));\n    console.log(`\uD83D\uDCBE Добавлено новых регионов: ${addedRegions}, всего оплаченных: ${window.paidRegions.length}`);\n\n    // \uD83C\uDFAF ОБНОВЛЯЕМ ЗАДАНИЯ\n    if (window.matryoshkaQuests && typeof window.matryoshkaQuests.refresh === 'function') {\n        console.log('\uD83D\uDD04 Обновляем задания...');\n        window.matryoshkaQuests.refresh();\n        console.log('✅ Задания обновлены после покупки пакета');\n    } else {\n        console.warn('⚠\uFE0F Система заданий не найдена или метод refresh отсутствует');\n    }\n}\n\n// Показ уведомления\nfunction showNotification(message) {\n    const notification = document.createElement('div');\n    notification.className = 'package-notification';\n    notification.textContent = message;\n\n    document.body.appendChild(notification);\n    setTimeout(() => notification.classList.add('show'), 10);\n\n    setTimeout(() => {\n        notification.classList.remove('show');\n        setTimeout(() => notification.remove(), 300);\n    }, 4000);\n}\n\n// Функции для работы с заданиями пакетов\nfunction sharePackage(packageId) {\n    const pkg = TRAVEL_PACKAGES.find(p => p.id === packageId);\n    if (!pkg) return;\n\n    // Создаем текст для шэринга\n    const shareText = `Посмотрите этот замечательный тур: ${pkg.name}! ${pkg.description}`;\n    const shareUrl = window.location.href;\n\n    // Если доступен Web Share API\n    if (navigator.share) {\n        navigator.share({\n            title: pkg.name,\n            text: shareText,\n            url: shareUrl\n        }).then(() => {\n            markQuestComplete('share', packageId);\n            showToast('✅ Спасибо за то, что поделились!', 3000);\n        }).catch(err => console.log('Ошибка шэринга:', err));\n    } else {\n        // Fallback: копируем ссылку в буфер обмена\n        navigator.clipboard.writeText(shareUrl).then(() => {\n            markQuestComplete('share', packageId);\n            showToast('\uD83D\uDCCB Ссылка скопирована в буфер обмена!', 3000);\n        });\n    }\n}\n\nfunction leaveReview(packageId) {\n    const review = prompt('Расскажите, что вам нравится в нашем сервисе:');\n    if (review && review.trim().length > 10) {\n        markQuestComplete('review', packageId);\n        showToast('⭐ Спасибо за отзыв! Вы получили бонус 500 ₽', 4000);\n    } else if (review !== null) {\n        showToast('❌ Отзыв слишком короткий (минимум 10 символов)', 3000);\n    }\n}\n\nfunction markQuestComplete(questType, packageId) {\n    const questData = JSON.parse(localStorage.getItem('packageQuests') || '{}');\n    if (!questData[packageId]) {\n        questData[packageId] = {};\n    }\n    questData[packageId][questType] = true;\n    localStorage.setItem('packageQuests', JSON.stringify(questData));\n\n    updateQuestDiscounts(packageId);\n}\n\nfunction updateQuestDiscounts(packageId) {\n    const pkg = TRAVEL_PACKAGES.find(p => p.id === packageId);\n    if (!pkg) return;\n\n    const questData = JSON.parse(localStorage.getItem('packageQuests') || '{}');\n    const packageQuests = questData[packageId] || {};\n\n    let totalDiscount = 0;\n    let bonusAmount = 0;\n\n    // Проверяем выполненные задания\n    if (packageQuests.favorites) totalDiscount += 5;\n    if (packageQuests.views) totalDiscount += 3;\n    if (packageQuests.share) totalDiscount += 2;\n    if (packageQuests.review) bonusAmount += 500;\n\n    // Обновляем отображение скидки\n    const totalDiscountEl = document.getElementById(`total-discount-${packageId}`);\n    if (totalDiscountEl) {\n        totalDiscountEl.textContent = `${totalDiscount}%` + (bonusAmount > 0 ? ` + ${bonusAmount} ₽` : '');\n    }\n\n    // Пересчитываем цену\n    const finalPrice = Math.round(pkg.price * (1 - totalDiscount / 100) - bonusAmount);\n    const bookBtnText = document.getElementById(`book-btn-text-${packageId}`);\n    if (bookBtnText) {\n        if (totalDiscount > 0 || bonusAmount > 0) {\n            bookBtnText.innerHTML = `Купить пакет за ${finalPrice.toLocaleString()} ₽ <small style=\"text-decoration: line-through; opacity: 0.7;\">${pkg.price.toLocaleString()} ₽</small>`;\n        } else {\n            bookBtnText.textContent = `Купить пакет за ${pkg.price.toLocaleString()} ₽`;\n        }\n    }\n}\n\n// Инициализация при загрузке страницы\ndocument.addEventListener('DOMContentLoaded', () => {\n    loadTravelPackages();\n});\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/scripts/modules/packages.js b/scripts/modules/packages.js
--- a/scripts/modules/packages.js	(revision 8f6d951bebaad31c3e38bcab0f58b81da2f711d9)
+++ b/scripts/modules/packages.js	(date 1764916726554)
@@ -53,26 +53,34 @@
     console.log(`✅ Найдено ${TRAVEL_PACKAGES.length} пакетов`);
     loadPackagesAttempts = 0; // Сбрасываем счетчик после успешной загрузки
 
-    packagesGrid.innerHTML = TRAVEL_PACKAGES.map(pkg => `
-        <div class="package-card aceternity-card spotlight-container ripple" onclick="showPackageModal('${pkg.id}')" data-package-id="${pkg.id}">
-            <div class="spotlight"></div>
-            <div class="package-image shimmer" style="background-image: url('${pkg.image}')"></div>
-            <div class="package-content">
-                <h3 class="package-name">${pkg.name}</h3>
-                <div class="package-duration">${pkg.duration}</div>
-                <div class="package-cities">
-                    ${pkg.cities.slice(0, 3).map(city => `<span class="city-tag">${city}</span>`).join('')}
-                    ${pkg.cities.length > 3 ? `<span class="city-tag">+${pkg.cities.length - 3}</span>` : ''}
+    packagesGrid.innerHTML = TRAVEL_PACKAGES.map((pkg, index) => `
+        <div class="package-card-new ${index === 0 ? 'popular' : ''}" onclick="showPackageModal('${pkg.id}')" data-package-id="${pkg.id}">
+            ${index === 0 ? '<div class="gradient-top-bar"></div>' : ''}
+
+            <div class="package-image-wrapper">
+                <img src="${pkg.image}" alt="${pkg.name}" class="package-image-new">
+                <div class="image-gradient-overlay"></div>
+                ${pkg.tag ? `<div class="package-tag">${pkg.tag}</div>` : ''}
+            </div>
+
+            <div class="package-content-new">
+                <div class="package-header-new">
+                    <h3 class="package-name-new">${pkg.name}</h3>
+                    <p class="package-duration-new">${pkg.duration} • ${pkg.cities.slice(0, 2).join(' → ')}</p>
                 </div>
-                <p class="package-description">${pkg.description}</p>
-                <div class="package-footer">
-                    <div class="package-price">
-                        ${pkg.oldPrice ? `<span class="old-price">${pkg.oldPrice.toLocaleString()} ₽</span>` : ''}
-                        <span class="current-price">${pkg.price.toLocaleString()} ₽</span>
+
+                <p class="package-description-new">${pkg.description}</p>
+
+                <div class="package-footer-new">
+                    <div class="package-price-new">
+                        ${pkg.oldPrice ? `<span class="old-price-new">${pkg.oldPrice.toLocaleString()} ₽</span>` : ''}
+                        <span class="current-price-new">от ${pkg.price.toLocaleString()} ₽</span>
                     </div>
-                    <button class="package-btn">Подробнее</button>
+                    <button class="package-btn-new">Подробнее</button>
                 </div>
             </div>
+
+            <div class="hover-glow"></div>
         </div>
     `).join('');
 
@@ -285,20 +293,6 @@
     }
 }
 
-// Переключение отображения деталей маршрута
-function toggleRoute(routeId, packageId) {
-    const routeDetails = document.getElementById(`route-${packageId}-${routeId}`);
-    const toggle = event.currentTarget.querySelector('.package-route-toggle');
-
-    if (routeDetails.style.display === 'none') {
-        routeDetails.style.display = 'block';
-        toggle.textContent = '▲';
-    } else {
-        routeDetails.style.display = 'none';
-        toggle.textContent = '▼';
-    }
-}
-
 // Бронирование пакета
 function bookPackage(packageId) {
     const pkg = TRAVEL_PACKAGES.find(p => p.id === packageId);
@@ -329,13 +323,13 @@
         expiresAt: expiresAt.toISOString(),
         cities: pkg.cities,
         price: pkg.price,
-        partners: partners  // 🔥 СОХРАНЯЕМ ПАРТНЕРОВ ВМЕСТЕ С ПАКЕТОМ!
+        partners: partners
     };
 
     purchasedPackages.push(purchasedPackage);
     localStorage.setItem('purchasedPackages', JSON.stringify(purchasedPackages));
 
-    // 🌍 Автоматически увеличиваем счетчик путешествий в профиле
+    // Увеличиваем счетчик путешествий в профиле
     try {
         const profileData = JSON.parse(sessionStorage.getItem('matryoshka_profile') || '{}');
         profileData.travels = (profileData.travels || 0) + 1;
@@ -346,28 +340,17 @@
     }
 
     console.log('💾 Пакет сохранен в localStorage:', purchasedPackage);
-    console.log('💾 Всего пакетов в localStorage:', purchasedPackages.length);
 
     // Показываем уведомление
     showNotification(`✅ Пакет "${pkg.name}" успешно куплен! Действителен до ${expiresAt.toLocaleDateString('ru-RU')}`);
     closePackageModal();
 
-    // 🔥 ОБНОВЛЯЕМ КОРЗИНУ И АВТОМАТИЧЕСКИ ОТКРЫВАЕМ ЕЕ
-    console.log('🔍 window.matryoshkaCart существует?', !!window.matryoshkaCart);
-    console.log('🔍 showCart функция существует?', typeof showCart);
-
+    // Обновляем корзину и открываем её
     if (window.matryoshkaCart) {
-        console.log('🔄 Обновляю корзину...');
         window.matryoshkaCart.refresh();
-        // Автоматически открываем корзину после покупки
         if (typeof showCart === 'function') {
             showCart();
-            console.log('✅ Корзина обновлена и открыта');
-        } else {
-            console.error('❌ showCart не является функцией!');
         }
-    } else {
-        console.error('❌ window.matryoshkaCart не найден!');
     }
 
     // Обновляем профиль если он открыт
@@ -375,10 +358,9 @@
         window.matryoshkaProfile.loadProfileData();
     }
 
-    // 🎯 ДОБАВЛЯЕМ РЕГИОНЫ ИЗ ПАКЕТА В ОПЛАЧЕННЫЕ И ГЕНЕРИРУЕМ ЗАДАНИЯ
+    // Добавляем регионы из пакета в оплаченные
     console.log('🎯 Добавляем регионы из пакета в оплаченные...');
 
-    // Инициализируем paidRegions если нужно
     if (typeof window.paidRegions === 'undefined') {
         window.paidRegions = [];
         const saved = localStorage.getItem('paidRegions');
@@ -391,25 +373,17 @@
         }
     }
 
-    // Для каждого города в пакете находим соответствующий регион
     let addedRegions = 0;
     pkg.cities.forEach(cityName => {
-        // Ищем регион с таким названием
         const regionEntry = Object.entries(window.RUSSIA_REGIONS_DATA || {}).find(([key, region]) => {
             return region.name === cityName || region.city === cityName;
         });
 
         if (regionEntry) {
             const [regionId, regionData] = regionEntry;
-
-            // Проверяем, не добавлен ли уже этот регион
             const existingRegion = window.paidRegions.find(r => r.id === regionId);
+
             if (!existingRegion) {
-                // Добавляем регион в оплаченные со сроком действия 7 дней
-                const purchaseDate = new Date();
-                const expiresAt = new Date(purchaseDate);
-                expiresAt.setDate(expiresAt.getDate() + 7);
-
                 const paidRegion = {
                     id: regionId,
                     purchaseDate: purchaseDate.toISOString(),
@@ -419,25 +393,16 @@
                 window.paidRegions.push(paidRegion);
                 addedRegions++;
                 console.log(`✅ Регион ${regionData.name} (${regionId}) добавлен в оплаченные`);
-            } else {
-                console.log(`ℹ️ Регион ${regionData.name} (${regionId}) уже оплачен`);
             }
-        } else {
-            console.warn(`⚠️ Не найден регион для города: ${cityName}`);
         }
     });
 
-    // Сохраняем обновленный список в sessionStorage
     localStorage.setItem('paidRegions', JSON.stringify(window.paidRegions));
-    console.log(`💾 Добавлено новых регионов: ${addedRegions}, всего оплаченных: ${window.paidRegions.length}`);
+    console.log(`💾 Добавлено новых регионов: ${addedRegions}`);
 
-    // 🎯 ОБНОВЛЯЕМ ЗАДАНИЯ
+    // Обновляем задания
     if (window.matryoshkaQuests && typeof window.matryoshkaQuests.refresh === 'function') {
-        console.log('🔄 Обновляем задания...');
         window.matryoshkaQuests.refresh();
-        console.log('✅ Задания обновлены после покупки пакета');
-    } else {
-        console.warn('⚠️ Система заданий не найдена или метод refresh отсутствует');
     }
 }
 
@@ -461,11 +426,9 @@
     const pkg = TRAVEL_PACKAGES.find(p => p.id === packageId);
     if (!pkg) return;
 
-    // Создаем текст для шэринга
     const shareText = `Посмотрите этот замечательный тур: ${pkg.name}! ${pkg.description}`;
     const shareUrl = window.location.href;
 
-    // Если доступен Web Share API
     if (navigator.share) {
         navigator.share({
             title: pkg.name,
@@ -473,13 +436,12 @@
             url: shareUrl
         }).then(() => {
             markQuestComplete('share', packageId);
-            showToast('✅ Спасибо за то, что поделились!', 3000);
+            showNotification('✅ Спасибо за то, что поделились!');
         }).catch(err => console.log('Ошибка шэринга:', err));
     } else {
-        // Fallback: копируем ссылку в буфер обмена
         navigator.clipboard.writeText(shareUrl).then(() => {
             markQuestComplete('share', packageId);
-            showToast('📋 Ссылка скопирована в буфер обмена!', 3000);
+            showNotification('📋 Ссылка скопирована в буфер обмена!');
         });
     }
 }
@@ -488,9 +450,9 @@
     const review = prompt('Расскажите, что вам нравится в нашем сервисе:');
     if (review && review.trim().length > 10) {
         markQuestComplete('review', packageId);
-        showToast('⭐ Спасибо за отзыв! Вы получили бонус 500 ₽', 4000);
+        showNotification('⭐ Спасибо за отзыв! Вы получили бонус 500 ₽');
     } else if (review !== null) {
-        showToast('❌ Отзыв слишком короткий (минимум 10 символов)', 3000);
+        showNotification('❌ Отзыв слишком короткий (минимум 10 символов)');
     }
 }
 
@@ -515,27 +477,20 @@
     let totalDiscount = 0;
     let bonusAmount = 0;
 
-    // Проверяем выполненные задания
     if (packageQuests.favorites) totalDiscount += 5;
     if (packageQuests.views) totalDiscount += 3;
     if (packageQuests.share) totalDiscount += 2;
     if (packageQuests.review) bonusAmount += 500;
 
-    // Обновляем отображение скидки
     const totalDiscountEl = document.getElementById(`total-discount-${packageId}`);
     if (totalDiscountEl) {
         totalDiscountEl.textContent = `${totalDiscount}%` + (bonusAmount > 0 ? ` + ${bonusAmount} ₽` : '');
     }
 
-    // Пересчитываем цену
-    const finalPrice = Math.round(pkg.price * (1 - totalDiscount / 100) - bonusAmount);
-    const bookBtnText = document.getElementById(`book-btn-text-${packageId}`);
-    if (bookBtnText) {
-        if (totalDiscount > 0 || bonusAmount > 0) {
-            bookBtnText.innerHTML = `Купить пакет за ${finalPrice.toLocaleString()} ₽ <small style="text-decoration: line-through; opacity: 0.7;">${pkg.price.toLocaleString()} ₽</small>`;
-        } else {
-            bookBtnText.textContent = `Купить пакет за ${pkg.price.toLocaleString()} ₽`;
-        }
+    const bookBtnEl = document.getElementById(`book-btn-text-${packageId}`);
+    if (bookBtnEl && totalDiscount > 0) {
+        const discountedPrice = Math.round(pkg.price * (1 - totalDiscount / 100) - bonusAmount);
+        bookBtnEl.textContent = `Купить за ${discountedPrice.toLocaleString()} ₽ (скидка ${totalDiscount}%${bonusAmount > 0 ? ` + ${bonusAmount} ₽` : ''})`;
     }
 }
 
Index: backend/api/feed_api.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>#!/usr/bin/env python3\n\"\"\"\nУпрощенное API для работы с лентой путешествий\nРаботает с новой таблицей travel_feed\n\"\"\"\n\nimport asyncio\nimport logging\nimport sys\nimport os\nfrom flask import Flask, jsonify, request\nfrom flask_cors import CORS\n\n# Добавляем путь к backend директории\nsys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))\nfrom database import db\n\n# Настройка логирования\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\n# Создаем Flask приложение\napp = Flask(__name__)\nCORS(app)  # Разрешаем CORS для всех доменов\n\n\ndef async_route(f):\n    \"\"\"Декоратор для асинхронных роутов\"\"\"\n    def wrapper(*args, **kwargs):\n        loop = asyncio.new_event_loop()\n        asyncio.set_event_loop(loop)\n        try:\n            return loop.run_until_complete(f(*args, **kwargs))\n        finally:\n            loop.close()\n    wrapper.__name__ = f.__name__\n    return wrapper\n\n\n@app.route('/api/feed', methods=['GET'])\n@async_route\nasync def get_feed():\n    \"\"\"Получить ленту путешествий\"\"\"\n    try:\n        # Получаем параметры из запроса\n        limit = request.args.get('limit', 50, type=int)\n        offset = request.args.get('offset', 0, type=int)\n\n        if not db:\n            return jsonify({\n                'error': 'База данных не инициализирована'\n            }), 500\n\n        # Получаем ленту из БД\n        photos = await db.get_travel_feed(limit=limit, offset=offset)\n\n        logger.info(f\"✅ Получено {len(photos)} фотографий из ленты\")\n\n        return jsonify({\n            'success': True,\n            'photos': photos,\n            'count': len(photos),\n            'limit': limit,\n            'offset': offset\n        })\n\n    except Exception as e:\n        logger.error(f\"❌ Ошибка получения ленты: {e}\", exc_info=True)\n        return jsonify({\n            'error': str(e),\n            'success': False\n        }), 500\n\n\n@app.route('/api/feed/<int:photo_id>', methods=['GET'])\ndef get_feed_photo(photo_id):\n    \"\"\"Получить конкретную фотографию по ID\"\"\"\n    try:\n        if not db:\n            return jsonify({'error': 'База данных не инициализирована'}), 500\n\n        # Получаем фото напрямую из travel_feed\n        result = db.client.table('travel_feed')\\\n            .select('*')\\\n            .eq('id', photo_id)\\\n            .execute()\n\n        if not result.data:\n            return jsonify({'error': 'Фотография не найдена'}), 404\n\n        photo = result.data[0]\n\n        return jsonify({\n            'success': True,\n            'photo': photo\n        })\n\n    except Exception as e:\n        logger.error(f\"❌ Ошибка получения фотографии: {e}\", exc_info=True)\n        return jsonify({'error': str(e), 'success': False}), 500\n\n\n@app.route('/api/feed/<int:photo_id>', methods=['DELETE'])\n@async_route\nasync def delete_feed_photo(photo_id):\n    \"\"\"Удалить фотографию из ленты\"\"\"\n    try:\n        if not db:\n            return jsonify({'error': 'База данных не инициализирована'}), 500\n\n        # Получаем информацию о фото перед удалением\n        result = db.client.table('travel_feed')\\\n            .select('photo_url')\\\n            .eq('id', photo_id)\\\n            .execute()\n\n        if not result.data:\n            return jsonify({'error': 'Фотография не найдена'}), 404\n\n        photo_url = result.data[0]['photo_url']\n\n        # Удаляем запись из БД\n        success = await db.delete_travel_photo(photo_id)\n\n        if success:\n            # Удаляем фото из Storage\n            db.delete_photo_from_storage(photo_url)\n\n            return jsonify({\n                'success': True,\n                'message': 'Фотография удалена'\n            })\n        else:\n            return jsonify({\n                'error': 'Не удалось удалить фотографию',\n                'success': False\n            }), 500\n\n    except Exception as e:\n        logger.error(f\"❌ Ошибка удаления фотографии: {e}\", exc_info=True)\n        return jsonify({'error': str(e), 'success': False}), 500\n\n\n@app.route('/api/users/<int:telegram_id>/photos', methods=['GET'])\n@async_route\nasync def get_user_photos(telegram_id):\n    \"\"\"Получить фотографии конкретного пользователя\"\"\"\n    try:\n        limit = request.args.get('limit', 50, type=int)\n\n        if not db:\n            return jsonify({'error': 'База данных не инициализирована'}), 500\n\n        # Получаем фотографии пользователя\n        photos = await db.get_user_travel_photos(telegram_id=telegram_id, limit=limit)\n\n        return jsonify({\n            'success': True,\n            'photos': photos,\n            'count': len(photos)\n        })\n\n    except Exception as e:\n        logger.error(f\"❌ Ошибка получения фото пользователя: {e}\", exc_info=True)\n        return jsonify({'error': str(e), 'success': False}), 500\n\n\n@app.route('/api/stats', methods=['GET'])\n@async_route\nasync def get_stats():\n    \"\"\"Получить статистику ленты\"\"\"\n    try:\n        if not db:\n            return jsonify({'error': 'База данных не инициализирована'}), 500\n\n        stats = await db.get_feed_stats()\n\n        return jsonify({\n            'success': True,\n            'stats': stats\n        })\n\n    except Exception as e:\n        logger.error(f\"❌ Ошибка получения статистики: {e}\", exc_info=True)\n        return jsonify({'error': str(e), 'success': False}), 500\n\n\n@app.route('/api/health', methods=['GET'])\ndef health_check():\n    \"\"\"Проверка работоспособности API\"\"\"\n    try:\n        db_status = 'connected' if db else 'disconnected'\n\n        return jsonify({\n            'status': 'healthy',\n            'database': db_status,\n            'message': 'Travel Feed API is running',\n            'version': '2.0 (Simplified)'\n        })\n    except Exception as e:\n        return jsonify({\n            'status': 'unhealthy',\n            'error': str(e)\n        }), 500\n\n\nif __name__ == '__main__':\n    logger.info(\"\uD83D\uDE80 Запуск Travel Feed API v2.0...\")\n\n    if not db:\n        logger.error(\"❌ База данных не инициализирована!\")\n        logger.error(\"Проверьте переменные окружения SUPABASE_URL и SUPABASE_KEY\")\n    else:\n        logger.info(\"✅ База данных подключена\")\n        logger.info(\"\uD83D\uDCCA Работаю с таблицей: travel_feed\")\n\n    # Запускаем сервер\n    app.run(\n        host='0.0.0.0',\n        port=5000,\n        debug=True\n    )\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/api/feed_api.py b/backend/api/feed_api.py
--- a/backend/api/feed_api.py	(revision 8f6d951bebaad31c3e38bcab0f58b81da2f711d9)
+++ b/backend/api/feed_api.py	(date 1764373840915)
@@ -215,8 +215,10 @@
         logger.info("📊 Работаю с таблицей: travel_feed")
 
     # Запускаем сервер
+    port = int(os.environ.get('PORT', 5002))
+    logger.info(f"🌐 Сервер запускается на порту: {port}")
     app.run(
         host='0.0.0.0',
-        port=5000,
+        port=port,
         debug=True
     )
