# üì∏ –§–û–¢–û-–°–ï–†–í–ï–† –î–õ–Ø –õ–ï–ù–¢–´ –ü–£–¢–ï–®–ï–°–¢–í–ò–ô

–ü—Ä–æ—Å—Ç–æ–π –∏ –±—ã—Å—Ç—Ä—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –ª–µ–Ω—Ç–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π –ú–∞—Ç—Ä–µ—à–∫–∞.

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

- **–†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –Ω–∞**: 10 —á–µ–ª–æ–≤–µ–∫ √ó 2 —Ñ–æ—Ç–∫–∏ = 20 —Ñ–æ—Ç–æ–∫ –º–∞–∫—Å–∏–º—É–º
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: –ü—Ä—è–º–æ –Ω–∞ –¥–∏—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤ –ø–∞–ø–∫–µ `travel_photos/`
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –¥–æ 1200√ó1200px, –∫–∞—á–µ—Å—Ç–≤–æ 85%
- **–°–∫–æ—Ä–æ—Å—Ç—å**: –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements_photo_server.txt
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
pip install Flask flask-cors Pillow
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
python photo_server.py
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:5000`

### 3. –û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–û—Ç–∫—Ä–æ–π `index.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –¥–æ–±–∞–≤—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —Å —Ñ–æ—Ç–∫–∞–º–∏!

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îú‚îÄ‚îÄ photo_server.py              # Flask —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ photo-storage-server.js      # JS –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º
‚îú‚îÄ‚îÄ requirements_photo_server.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ travel_photos/               # –ü–∞–ø–∫–∞ —Å —Ñ–æ—Ç–∫–∞–º–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ metadata.json           # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö —Ñ–æ—Ç–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ uuid-1.jpg              # –§–æ—Ç–∫–∞ 1
‚îÇ   ‚îî‚îÄ‚îÄ uuid-2.jpg              # –§–æ—Ç–∫–∞ 2
```

## üîå API Endpoints

### `POST /api/upload-photo`
–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (multipart/form-data):**
- `photo` (file) - –§–∞–π–ª —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
- `travel_id` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - ID –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
- `user_id` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "photo_id": "unique-id",
  "photo_url": "/api/photo/unique-id",
  "size": 125648
}
```

### `GET /api/photo/<photo_id>`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ ID

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JPEG —Ñ–∞–π–ª

### `GET /api/travel-photos`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "photos": [
    {
      "photo_id": "unique-id",
      "photo_url": "/api/photo/unique-id",
      "uploaded_at": "2025-01-05T12:00:00",
      "size": 125648,
      "travel_id": "123",
      "user_id": "user_1"
    }
  ],
  "total": 1
}
```

### `DELETE /api/delete-photo/<photo_id>`
–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true
}
```

### `GET /api/health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "photos_count": 20,
  "photos_dir": "/path/to/travel_photos",
  "timestamp": "2025-01-05T12:00:00"
}
```

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### JavaScript (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è)

```javascript
// –ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
const photoUrl = await window.photoStorageServer.uploadPhoto(
    file,
    'travel_123',
    'user_1'
);

// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
const photoUrls = await window.photoStorageServer.uploadMultiplePhotos(
    [file1, file2],
    'travel_123',
    'user_1'
);

// –ó–∞–≥—Ä—É–∑–∫–∞ base64 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
const photoUrls = await window.photoStorageServer.uploadBase64Photos(
    ['data:image/jpeg;base64,...', 'data:image/jpeg;base64,...'],
    'travel_123',
    'user_1'
);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
const isAvailable = await window.photoStorageServer.checkServerHealth();
```

## üé® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –°–∂–∞—Ç–∏–µ –¥–æ 1200√ó1200px (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ JPEG —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 85%
- –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 100-200 KB

### Fallback –Ω–∞ base64
–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ñ–æ—Ç–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ base64

### –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
–î–ª—è –∫–∞–∂–¥–æ–π —Ñ–æ—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
- ID —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
- –î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- ID –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞

## üåê –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

### –í–∞—Ä–∏–∞–Ω—Ç 1: Railway / Render / Heroku

1. –°–æ–∑–¥–∞–π `Procfile`:
```
web: gunicorn photo_server:app
```

2. –î–æ–±–∞–≤—å `gunicorn` –≤ requirements:
```bash
echo "gunicorn==21.2.0" >> requirements_photo_server.txt
```

3. –ó–∞–¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Git:
```bash
git add .
git commit -m "Add photo server"
git push heroku main
```

4. –û–±–Ω–æ–≤–∏ URL –≤ `photo-storage-server.js`:
```javascript
this.serverUrl = 'https://your-app.herokuapp.com';
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: VPS (Ubuntu)

1. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
apt update
apt install python3-pip nginx
pip3 install -r requirements_photo_server.txt
pip3 install gunicorn
```

2. –°–æ–∑–¥–∞–π systemd service `/etc/systemd/system/photoserver.service`:
```ini
[Unit]
Description=Photo Server
After=network.target

[Service]
User=www-data
WorkingDirectory=/var/www/matreshka
ExecStart=/usr/bin/gunicorn -w 4 -b 0.0.0.0:5000 photo_server:app
Restart=always

[Install]
WantedBy=multi-user.target
```

3. –ù–∞—Å—Ç—Ä–æ–π Nginx:
```nginx
server {
    listen 80;
    server_name photos.example.com;

    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

4. –ó–∞–ø—É—Å—Ç–∏:
```bash
systemctl enable photoserver
systemctl start photoserver
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è –º–∞–ª–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- CORS –≤–∫–ª—é—á–µ–Ω –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 2MB
- –§–æ—Ä–º–∞—Ç—ã: JPG, PNG –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ JPEG

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
1. –î–æ–±–∞–≤—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (JWT —Ç–æ–∫–µ–Ω—ã)
2. –û–≥—Ä–∞–Ω–∏—á—å CORS —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º –¥–æ–º–µ–Ω–æ–º
3. –î–æ–±–∞–≤—å rate limiting (flask-limiter)
4. –í–∫–ª—é—á–∏ HTTPS (Let's Encrypt)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞:
```bash
curl http://localhost:5000/api/health
```

–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–æ—Ç–æ–∫:
```bash
curl http://localhost:5000/api/travel-photos
```

## üêõ –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

### –ü—Ä–æ–±–ª–µ–º–∞: –§–æ—Ç–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: `curl http://localhost:5000/api/health`
2. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ CORS
3. –£–±–µ–¥–∏—Å—å —á—Ç–æ `photo-storage-server.js` –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `index.html`

### –ü—Ä–æ–±–ª–µ–º–∞: –§–æ—Ç–∫–∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ
**–†–µ—à–µ–Ω–∏–µ:**
–ò–∑–º–µ–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ `photo_server.py`:
```python
optimize_image(image_data, max_size=(800, 800), quality=75)
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–µ—Ä –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ñ–æ—Ç–æ–∫
**–†–µ—à–µ–Ω–∏–µ:**
1. –£–≤–µ–ª–∏—á—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ gunicorn: `gunicorn -w 8 ...`
2. –î–æ–±–∞–≤—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis
3. –ò—Å–ø–æ–ª—å–∑—É–π CDN –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å—Ç–∞—Ç–∏–∫–∏

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ó–∞–≥—Ä—É–∑–∫–∞ 1 —Ñ–æ—Ç–∫–∏: ~200ms
- –ó–∞–≥—Ä—É–∑–∫–∞ 10 —Ñ–æ—Ç–æ–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ: ~500ms
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ç–∫–∏ –∏–∑ –∫–µ—à–∞: ~10ms

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
1. **Nginx –∫–∞–∫ reverse proxy** - —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ Flask
2. **CDN (Cloudflare)** - –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–¥–∞—á–∞ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É
3. **Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
4. **WebP —Ñ–æ—Ä–º–∞—Ç** - –µ—â–µ –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT - –¥–µ–ª–∞–π —á—Ç–æ —Ö–æ—á–µ—à—å!

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Å—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–æ—Ç–æ–∫! üöÄ
