<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</title>
    <style>
        body {
            background: #0f0520;
            color: #fff;
            font-family: monospace;
            padding: 20px;
        }
        pre {
            background: #1a0a3a;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            background: #ffcc00;
            color: #000;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #ff8e53;
        }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage</h1>

    <button onclick="checkStorage()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
    <button onclick="checkIndexedDB()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å IndexedDB</button>
    <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –í–°–Å</button>

    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
    <pre id="output">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏...</pre>

    <script>
        function checkStorage() {
            const output = document.getElementById('output');
            let result = '=== localStorage ===\n\n';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º matryoshka_all_travels
            const travels = localStorage.getItem('matryoshka_all_travels');
            if (travels) {
                const parsed = JSON.parse(travels);
                result += `‚úÖ matryoshka_all_travels: ${parsed.length} –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π\n\n`;

                parsed.forEach((t, i) => {
                    result += `${i + 1}. "${t.title}"\n`;
                    result += `   - ID: ${t.id}\n`;
                    result += `   - GlobalID: ${t.globalId}\n`;
                    result += `   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${t.images?.length || 0}\n`;
                    if (t.images && t.images.length > 0) {
                        result += `   - –ü–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${t.images[0].substring(0, 50)}...\n`;
                        result += `   - –î–ª–∏–Ω–∞ –ø–µ—Ä–≤–æ–≥–æ: ${t.images[0].length} —Å–∏–º–≤–æ–ª–æ–≤\n`;
                    } else {
                        result += `   ‚ùå –ù–ï–¢ –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô!\n`;
                    }
                    result += '\n';
                });
            } else {
                result += '‚ùå matryoshka_all_travels –ù–ï –ù–ê–ô–î–ï–ù–û\n';
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∫–ª—é—á–∏
            result += '\n=== –í—Å–µ –∫–ª—é—á–∏ localStorage ===\n';
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    const value = localStorage.getItem(key);
                    result += `\n${key}: ${(value.length / 1024).toFixed(2)} KB\n`;
                }
            }

            output.textContent = result;
        }

        async function checkIndexedDB() {
            const output = document.getElementById('output');
            let result = '=== IndexedDB ===\n\n';

            try {
                const dbRequest = indexedDB.open('MatryoshkaDB', 1);

                dbRequest.onsuccess = (event) => {
                    const db = event.target.result;
                    const tx = db.transaction(['travels'], 'readonly');
                    const store = tx.objectStore('travels');
                    const getAllRequest = store.getAll();

                    getAllRequest.onsuccess = () => {
                        const travels = getAllRequest.result;
                        result += `‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π: ${travels.length}\n\n`;

                        travels.forEach((t, i) => {
                            result += `${i + 1}. "${t.title}"\n`;
                            result += `   - ID: ${t.id}\n`;
                            result += `   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${t.images?.length || 0}\n`;
                            if (t.images && t.images.length > 0) {
                                result += `   - –ü–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${t.images[0].substring(0, 50)}...\n`;
                            }
                            result += '\n';
                        });

                        output.textContent = result;
                    };
                };

                dbRequest.onerror = () => {
                    result += '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è IndexedDB\n';
                    output.textContent = result;
                };
            } catch (error) {
                result += `‚ùå –û—à–∏–±–∫–∞: ${error.message}\n`;
                output.textContent = result;
            }
        }

        function clearAll() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage –∏ IndexedDB?')) {
                // –û—á–∏—Å—Ç–∫–∞ localStorage
                localStorage.clear();

                // –û—á–∏—Å—Ç–∫–∞ IndexedDB
                indexedDB.deleteDatabase('MatryoshkaDB');

                document.getElementById('output').textContent = '‚úÖ –í—Å—ë –æ—á–∏—â–µ–Ω–æ!';
            }
        }
    </script>
</body>
</html>
